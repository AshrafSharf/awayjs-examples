{"version":3,"sources":["webpack:///./src/Intermediate_MD5Animation.ts"],"names":[],"mappings":";;;;;;;;;;;;AAsCE;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAE6I;AACH;AACiF;AACrD;AAC1D;AACzC;AAC3B;AAE1C;AA0DI;;;AACH;AAhDQ,aAAe,kBAAuB,IAAuB,8EAAM;AAOnE,aAAkB,qBAAY;AAmB9B,aAAK,QAAY;AAiBjB,aAAK,QAAY;AAOpB,aACL;AAAC;AAIE;;;AACK,wCAAI,OAAZ;AAEK,aAAc;AACA;AACd,aAAc;AACd,aAAiB;AACjB,aAAe;AACf,aACL;AAAC;AAIE;;;AACK,wCAAU,aAAlB;AAEK,aAAK,OAAG,IAAW;AACnB,aAAM,QAAO,KAAK,KAAO;AACzB,aAAO,SAAO,KAAK,KAAQ;AAE3B,aAAO,OAAW,WAAI,MAAQ;AAC9B,aAAO,OAAE,IAAG,CAAK;AACjB,aAAO,OAAE,IAAO;AAEuB;AACvC,aAAY,cAAG,IAA6B;AAC5C,aAAY,YAAE,IAAM;AACpB,aAAiB,mBAAG,IAAoB,wEAAK,KAAO,QAAM,KAC/D;AAAC;AAIE;;;AACuB;AACtB;AACuB;AAC0C;AAChD;AACC;AACM;AACE;AACgB;AACI;AACJ;AACiB;AAC9D;AACkB;AACf;AAID;;;AACK,wCAAU,aAAlB;AAE0E;AACrE,aAAS,WAAG,IAAiB;AAC7B,aAAS,SAAE,IAAG,CAAM;AACpB,aAAS,SAAE,IAAO;AAClB,aAAS,SAAE,IAAG,CAAM;AACpB,aAAS,SAAM,QAAY;AAC3B,aAAM,MAAS,SAAK,KAAW;AAE/B,aAAU,YAAG,IAAiB;AAC9B,aAAU,UAAE,IAAQ;AACpB,aAAU,UAAE,IAAO;AACnB,aAAU,UAAE,IAAQ;AACpB,aAAU,UAAM,QAAY;AAC5B,aAAM,MAAS,SAAK,KAAY;AAEhC,aAAW,aAAG,IAAoB,wEAAC,CAAG,IAAE,CAAG,IAAM;AACjD,aAAW,WAAM,QAAY;AAC7B,aAAW,WAAa,eAAQ;AAChC,aAAW,WAAQ,UAAK;AACxB,aAAW,WAAa,eAAY;AACpC,aAAW,WAAa,eAAG,IAA+B,mFAAK;AAC/D,aAAM,MAAS,SAAK,KAAa;AAEjC,aAAY,cAAG,IAAqB,yEAAC,CAAK,KAAS,UAAM,KAAU,WAAM,KAAc;AAG5D;AAC3B,aAAgB,kBAAG,IAAoB,4EAAC,IAAoB,4EAAK,KAAW,YAAI,IAAM;AACtF,aAAgB,gBAAQ,UAAM;AAEN;AACxB,aAAU,YAAG,IAAmB,2EAAE,GAAM,KAAO,OAAW,WAAI,MAAI,KACvE;AAAC;AAIE;;;AACK,wCAAa,gBAArB;AAEqB;AAChB,aAAiB,mBAAG,IAAqB;AACzC,aAAiB,iBAAc,gBAAQ;AACvC,aAAiB,iBAAgB,gBAAK,KAAY;AAEjC;AACjB,aAAkB,oBAAG,IAAqB;AAC1C,aAAkB,kBAAc,gBAAQ;AACxC,aAAkB,kBAAgB,gBAAK,KAAY;AAEtC;AACb,aAAe,iBAAG,IAAqB;AACvC,aAAe,eAAM,MAAQ,UAAG,IAAa,oEAAK,MAAQ;AAC1D,aAAe,eAAY,cAAO,KAAa;AAC/C,aAAe,eAAa,eAAO,KAAiB;AACpD,aAAe,eAAgB,gBAAK,KAAY;AAErC;AACX,aAAa,eAAG,IAAqB;AACrC,aAAa,aAAe,eAAM,QAAM;AACxC,aAAa,aAAe,eAAS,WAAO;AAC5C,aAAa,aAAgB,gBAAK,KAAY;AAC9C,aAAa,aAAY,cAAO,KAAa;AAC7C,aAAa,aAAa,eAAO,KAAiB;AAExC;AACV,aAAY,cAAG,IAAqB;AACpC,aAAY,YAAc,gBAAQ;AAClC,aAAY,YAAM,MAAQ,UAAG,IAAa,oEAAK,MAAQ;AACvD,aAAY,YAAW,aAAQ;AAC/B,aAAY,YAAgB,gBAAK,KAAY;AAC7C,aAAY,YAAY,cAAO,KAAa;AAC5C,aAAY,YAAa,eAAO,KACrC;AAAC;AAIE;;;AACK,wCAAW,cAAnB;AAE0B;AACzB,YAAa,YAAa,IAAa,iEAAK,KAAmB;AACtD,kBAAM,QAAO;AACb,kBAAO,SAAO;AACd,kBAAa,eAAS;AAC/B,YAAc,aAAa,IAAa,iEAAK,KAAoB;AACvD,mBAAM,QAAO;AACb,mBAAO,SAAO;AACd,mBAAa,eAAS;AAC5B,aAAS,SAAS,SAAY;AAC9B,aAAU,UAAS,SAAa;AAExB,2EAAa,aAAgB;AAC7B,2EAAa,aAAgB;AAEZ;AACzB,aAAO,SAAY,IAAwB,4EAAK,KAAe,gBAAc,uEAAS,UAAO,OAAO,OAAG,GAAI,GAAgB;AAC3H,aAAO,OAAS,SAAQ,QAAI,KAAO;AACnC,aAAO,OAAa,eAAS;AAC7B,aAAM,MAAS,SAAK,KACzB;AAAC;AAIE;;;AACK,wCAAa,gBAArB;AAAA,oBAqCC;AAnCM,eAAS,WAAI,UAAM;AAAK,mBAAI,MAAS,SAAO;AAAC;AAC3C,iBAAU,YAAG,UAAM;AAAK,mBAAI,MAAU,UAAO;AAAC;AAC9C,iBAAQ,UAAG,UAAM;AAAK,mBAAI,MAAQ,QAAO;AAAC;AAE9C,aAAY;AAEZ,aAAO,SAAG,IAAyB,4EAAK,KAAa,cAAQ;AAC7D,aAAO,OAAS;AAEgC;AACpD,YAAiB,gBAAiB,IAAoB;AACzC,sBAAkB,oBAAoB;AAE3B;AACZ,2EAAiB,iBAAW,iEAAe,gBAAE,UAAiB;AAAK,mBAAI,MAAgB,gBAAO;AAAE;AAChG,2EAAiB,iBAAY,kEAAc,eAAE,UAAkB;AAAK,mBAAI,MAAmB,mBAAO;AAAE;AACpG,2EAAK,KAAC,IAAc,iEAAwC,yCAAM,MAAM,MAAE,IAAqB;AAEjF;AACd,2EAAK,KAAC,IAAc,iEAAwC,yCAAiB;AAEpE;AACT,2EAAK,KAAC,IAAc,iEAAyB;AAC7C,2EAAK,KAAC,IAAc,iEAA0B;AAErC;AACT,2EAAK,KAAC,IAAc,iEAAiC;AACrD,2EAAK,KAAC,IAAc,iEAAiC;AACrD,2EAAK,KAAC,IAAc,iEAAkC;AAExC;AACd,2EAAK,KAAC,IAAc,iEAA8C;AAClE,2EAAK,KAAC,IAAc,iEAA8C;AAClE,2EAAK,KAAC,IAAc,iEAA+C;AACnE,2EAAK,KAAC,IAAc,iEACjC;AAAC;AAIE;;;AACK,wCAAY,eAApB,UAA8B;AAEzB,aAAM,SAAO;AAEb,aAAiB,iBAAU;AAEH;AACzB,YAAK,KAAQ,QAAE;AACb,iBAAS,SAAS,SAAM,KAAC,CAAK,KAAM,QAAK,OAAM;AAC/C,iBAAO,OAAU,aAAQ,KAC9B;AAAC;AAEG,aAAM,SAAS;AAEf,aAAS,SAAE,IAAO,KAAI,IAAK,KAAO,SAAM;AACxC,aAAS,SAAE,IAAM,MAAO,KAAI,IAAK,KAAM,QAAM,QAAK;AAClD,aAAS,SAAE,IAAO,KAAI,IAAK,KAAM,QAAK,OAAM;AAC5C,aAAU,UAAE,IAAG,CAAK,KAAI,IAAK,KAAM,QAAK,OAAM;AAC9C,aAAU,UAAE,IAAM,MAAO,KAAI,IAAK,KAAM,QAAK,OAAK;AAClD,aAAU,UAAE,IAAG,CAAK,KAAI,IAAK,KAAM,QAAK,OAAM;AAE9C,aAAK,KACV;AAAC;AAIE;;;AACK,wCAAe,kBAAvB,UAAwC;AAAxC,oBA0CC;AAxCG,YAAM,MAAM,MAAQ,QAAoB,8EAAE;AAE5C,gBAAQ,OAA4C,MAAO;AAC3D,gBAAQ,OAAe,MAAM,MAAgB;AAEzC,iBAAK,OAAQ;AACb,iBAAa,aAAa,aAAO;AAElC,gBAAK,QAA6B,0BAAU,aAAQ,QAA6B,0BAAW,WAAE;AAC5F,qBAAQ,UACb;AAAM,mBAAE;AACH,qBAAQ,UAAS;AACjB,qBAAiB,iBAAoB,8EAAkB,mBAAE,UAA0B;AAAK,2BAAI,MAAmB,mBAAO;AAC3H;AAAC;AAEE,gBAAK,QAA6B,0BAAW,WAC3C,KACN;AAAM,mBAAU,MAAM,MAAQ,QAAmB,6EAAE;AAC9C,iBAAa,eAA+B,MAAO;AACnD,iBAAS,WAAG,IAAoB,2EAAK,KAAa,cAAM,KAAW;AACnE,iBAAC,IAAK,IAAoB,GAAG,IAA4B,0BAAW,WAAO,QAAE,EAAG,GACvE,mEAAK,KAAC,IAAc,iEAAqB,uBAA4B,0BAAW,WAAG,KAAc,aAAM,MAA2B,0BAAW,WAAG,IAAE,IAAqB;AAEhL,iBAAO,OAAS,WAAO,KAC5B;AAAM,SAPI,UAOM,MAAM,MAAQ,QAAW,qEAAE;AACtC,iBAAS,WAAmB,MACjC;AAAM,SAFI,MAEA,IAAM,MAAM,MAAQ,QAAS,gEAAE;AACW;AAC/C,iBAAO,SAAiB,MAAO;AAC/B,iBAAO,OAAS,SAAW,WAAG,GAAS,WAAO,KAAc;AAC5D,iBAAO,OAAS,SAAW,WAAG,GAAS,WAAO,KAAO,OAAS,SAAW,WAAG,GAAS,WAAO,KAAO,OAAS,SAAW,WAAG,GAAS,WAAO,KAAa;AACvJ,iBAAO,OAAa,eAAQ;AAC5B,iBAAO,OAAU,YAAO;AACxB,iBAAS,WAAO,KAAO,OAAS,SAAW,WAAG,GAAM,QAAO,KAAO,OAAS,SAAW,WAAG,GAAM,QAAO,KAAO,OAAS,SAAW,WAAG,GAAM,QAAG,IAAY;AACzJ,iBAAS,SAAS,WAAG,IAAa;AAClC,iBAAM,MAAS,SAAK,KAAS;AAEI;AACjC,iBAAO,OAAS,SAAK,KAC1B;AACD;AAAC;AAIE;;;AACK,wCAAkB,qBAA1B,UAA6C;AAEtC,gBAAO,MACZ;AACqB;AACrB,iBAA2C;AACtC,qBAAO,SAAG,IAAU,8DAAwB,MAAO,OAAK;AACxD,qBAAM,MAAS,SAAK,KAAS;AAC3B;AAEY;AACnB,iBAA0B;AACrB,qBAAiB,iBAAc,cAAQ,UAAG,IAAmB,0EAAsB,MAAO,OAAK;AAC7F;AACP,iBAA2B;AACtB,qBAAkB,kBAAc,cAAQ,UAAG,IAAmB,0EAAsB,MAAO,OAAK;AAC9F;AAES;AAChB,iBAAkC;AAC7B,qBAAe,eAAc,cAAQ,UAAG,IAAmB,0EAAsB,MAAO,OAAK;AAC3F;AACP,iBAAkC;AAC7B,qBAAe,eAAa,aAAQ,UAAG,IAAmB,0EAAsB,MAAO,OAAK;AAC1F;AACP,iBAAmC;AAC9B,qBAAe,eAAe,eAAQ,UAAG,IAAmB,0EAAsB,MAAO,OAAK;AAC5F;AAEc;AACrB,iBAA+C;AAC1C,qBAAa,aAAc,cAAQ,UAAG,IAAmB,0EAAsB,MAAO,OAAK;AACzF;AACP,iBAA+C;AAC1C,qBAAa,aAAa,aAAQ,UAAG,IAAmB,0EAAsB,MAAO,OAAK;AACxF;AACP,iBAAgD;AAC3C,qBAAa,aAAe,eAAQ,UAAG,IAAmB,0EAAsB,MAAO,OAAK;AAC1F;AACP,iBAAgC;AAC3B,qBAAY,YAAe,eAAQ,UAAO,KAAY,YAAc,cAAQ,UAAG,IAAmB,0EAAsB,MAAO,OAAK;AAG3I;;AAAC;AAEO,wCAAkB,qBAA1B,UAAoD;AAEhD,YAAK,KAAS,SAAY,eAAS,MAAgB,gBAC9C;AAEJ,aAAS,WAAQ;AAEjB,aAAS,SAAK,KAAK,KAAY,aAAM,KAAkB;AACvD,aAAS,SAAc,gBAAO,KAAS,WAAM,KAAmB,qBAAK,KAAU,YAA2B,0BAAU,YAA4B,0BAAY,cAA4B,0BAC7L;AAAC;AAEO,wCAAU,aAAlB,UAA6B,IAAS;AAEjC,aAAS,WAA4B,0BAAW,WAAI,MAAM;AAC1D,aAAS,SAAc,gBAA4B,0BAAc;AACjE,aAAS,SAAK,KAAK,KAAS,UAAM,KAAgB,iBACvD;AAAC;AAIE;;;AACK,wCAAS,YAAjB,UAAuB;AAEf,gBAAM,MAAW;AACvB,iBAAa,+DAAM;AACd,qBAAU,YAAQ;AACnB,oBAAK,KAAU,UACb,KAAe,eAAK,KAAoB;AACvC;AACP,iBAAa,+DAAI;AACjB,iBAAa,+DAAG;AAChB,iBAAa,+DAAE;AACV,qBAAe,eAAK,KAAkB,oBAAM;AAC1C;AACP,iBAAa,+DAAM;AACnB,iBAAa,+DAAE;AACV,qBAAe,eAAK,KAAkB,oBAAG,CAAI;AAC3C;AACP,iBAAa,+DAAM;AACnB,iBAAa,+DAAG;AAChB,iBAAa,+DAAE;AACV,qBAAmB,qBAAG,CAA0B,0BAAgB;AAC9D;AACP,iBAAa,+DAAO;AACpB,iBAAa,+DAAE;AACV,qBAAmB,qBAA4B,0BAAgB;AAGtE;;AAAC;AAIE;;;AACK,wCAAO,UAAf,UAAqB;AAEb,gBAAM,MAAW;AACvB,iBAAa,+DAAM;AACd,qBAAU,YAAS;AACpB,oBAAK,KAAU,UACb,KAAe,eAAK,KAAoB;AACvC;AACP,iBAAa,+DAAI;AACjB,iBAAa,+DAAG;AAChB,iBAAa,+DAAG,GAAK;AACrB,iBAAa,+DAAM;AACnB,iBAAa,+DAAE;AACV,qBAAQ;AACN;AACP,iBAAa,+DAAM;AACnB,iBAAa,+DAAG;AAChB,iBAAa,+DAAG,GAAK;AACrB,iBAAa,+DAAO;AACpB,iBAAa,+DAAE;AACV,qBAAmB,qBAAK;AACtB;AACP,iBAAa,+DAAS;AACjB,qBAAW,WAAI;AACb;AACP,iBAAa,+DAAS;AACjB,qBAAW,WAAI;AACb;AACP,iBAAa,+DAAS;AACjB,qBAAW,WAAI;AACb;AACP,iBAAa,+DAAS;AACjB,qBAAW,WAAI;AACb;AACP,iBAAa,+DAAS;AACjB,qBAAW,WAAI;AACb;AACP,iBAAa,+DAAS;AACjB,qBAAW,WAAI;AACb;AACP,iBAAa,+DAAS;AACjB,qBAAW,WAAI;AACb;AACP,iBAAa,+DAAS;AACjB,qBAAW,WAAI;AACb;AACP,iBAAa,+DAAS;AACjB,qBAAW,WAAI;AAGtB;;AAAC;AAEO,wCAAc,iBAAtB,UAAiC;AAE5B,aAAS,WAAQ;AACjB,aAAS,SAAc,gBAAO,OAAK,KAAU,YAA2B,0BAAU,YAA4B,0BAAa;AAE5H,YAAK,KAAY,eAA6B,0BAAW,WACpD;AAEJ,aAAY,cAA4B,0BAAW;AAEpD,YAAK,KAAU,UACV;AAES;AACb,aAAS,SAAK,KAAK,KAAY,aAAM,KAC1C;AAAC;AAEO,wCAAI,OAAZ;AAEK,aAAS,WAAS;AAEnB,YAAK,KAAY,eAA6B,0BAAW,WACpD;AAEJ,aAAY,cAA4B,0BAAW;AAEpD,YAAK,KAAU,UACV;AAES;AACb,aAAS,SAAc,gBAA4B,0BAAY;AAC/D,aAAS,SAAK,KAAK,KAAY,aAAM,KAC1C;AAAC;AAIE;;;AACK,wCAAQ,WAAhB,UAAmC;AAAlB;AAAA,oBAAkB;;AAE9B,aAAK,KAAM,QAAS,OAAY;AAChC,aAAK,KAAO,SAAS,OAC1B;AAAC;AACF,WAAC;AAAA;AAhgBqB;AACN,0BAAS,YAAkB;AAC3B,0BAAS,YAAkB;AAC3B,0BAAU,aAAiB,IAAS,MAAkC,0BAAU,WAA2B,0BAAU,WAAW,WAAiB,iBAAW,WAAS,SAAS,SAAa,aAAY,YAAS,SAAe,eAAmB;AAClP,0BAAc,iBAAY;AAC1B,0BAAS,YAAY;AACrB,0BAAU,aAAY;AACtB,0BAAU,aAAY;AACtB,0BAAY,eAAY;AA2flC,OAAO,SAAG;AAEf,QACD;AAAC,E","file":"js/Intermediate_MD5Animation.js","sourcesContent":["/*\n\nMD5 animation loading and interaction example in Away3d\n\nDemonstrates:\n\nHow to load MD5 sprite and anim files with bones animation from embedded resources.\nHow to map animation data after loading in order to playback an animation sequence.\nHow to control the movement of a game character using keys.\n\nCode by Rob Bateman & David Lenaerts\nrob@infiniteturtles.co.uk\nhttp://www.infiniteturtles.co.uk\ndavid.lenaerts@gmail.com\nhttp://www.derschmale.com\n\nThis code is distributed under the MIT License\n\nCopyright (c) The Away Foundation http://www.theawayfoundation.org\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the “Software”), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n\n*/\n\nimport {AssetEvent, LoaderEvent, Matrix, AssetLibrary, LoaderContext, URLRequest, RequestAnimationFrame, Keyboard} from \"awayjs-full/lib/core\";\nimport {AnimationNodeBase, Style, BitmapImage2D, BitmapImageCube, Sampler2D, ElementsType, Single2DTexture} from \"awayjs-full/lib/graphics\";\nimport {LookAtController, PointLight, DirectionalLight, Sprite, Scene, Camera, DisplayObjectContainer, Skybox, Billboard, StaticLightPicker, NearDirectionalShadowMapper, PrimitivePlanePrefab} from \"awayjs-full/lib/scene\";\nimport {AnimationSetBase, SkeletonAnimationSet, SkeletonAnimator, Skeleton, SkeletonClipNode, CrossfadeTransition, AnimationStateEvent} from \"awayjs-full/lib/renderer\";\nimport {MethodMaterial, EffectFogMethod, ShadowNearMethod, ShadowSoftMethod} from \"awayjs-full/lib/materials\";\nimport {MD5AnimParser, MD5MeshParser} from \"awayjs-full/lib/parsers\";\nimport {View} from \"awayjs-full/lib/view\";\n\nclass Intermediate_MD5Animation\n{\n\t//engine variables\n\tprivate scene:Scene;\n\tprivate camera:Camera;\n\tprivate view:View;\n\tprivate cameraController:LookAtController;\n\n\t//animation variables\n\tprivate animator:SkeletonAnimator;\n\tprivate animationSet:SkeletonAnimationSet;\n\tprivate stateTransition:CrossfadeTransition = new CrossfadeTransition(0.5);\n\tprivate skeleton:Skeleton;\n\tprivate isRunning:Boolean;\n\tprivate isMoving:Boolean;\n\tprivate movementDirection:number;\n\tprivate onceAnim:string;\n\tprivate currentAnim:string;\n\tprivate currentRotationInc:number = 0;\n\n\t//animation constants\n\tprivate static IDLE_NAME:string = \"idle2\";\n\tprivate static WALK_NAME:string = \"walk7\";\n\tprivate static ANIM_NAMES:Array<string> = new Array<string>(Intermediate_MD5Animation.IDLE_NAME, Intermediate_MD5Animation.WALK_NAME, \"attack3\", \"turret_attack\", \"attack2\", \"chest\", \"roar1\", \"leftslash\", \"headpain\", \"pain1\", \"pain_luparm\", \"range_attack2\");\n\tprivate static ROTATION_SPEED:number = 3;\n\tprivate static RUN_SPEED:number = 2;\n\tprivate static WALK_SPEED:number = 1;\n\tprivate static IDLE_SPEED:number = 1;\n\tprivate static ACTION_SPEED:number = 1;\n\n\t//light objects\n\tprivate redLight:PointLight;\n\tprivate blueLight:PointLight;\n\tprivate whiteLight:DirectionalLight;\n\tprivate lightPicker:StaticLightPicker;\n\tprivate shadowMapMethod:ShadowNearMethod;\n\tprivate fogMethod:EffectFogMethod;\n\tprivate count:number = 0;\n\n\t//material objects\n\tprivate redLightMaterial:MethodMaterial;\n\tprivate blueLightMaterial:MethodMaterial;\n\tprivate groundMaterial:MethodMaterial;\n\tprivate bodyMaterial:MethodMaterial;\n\tprivate gobMaterial:MethodMaterial;\n\n\t//scene objects\n\tprivate placeHolder:DisplayObjectContainer;\n\tprivate sprite:Sprite;\n\tprivate gobStyle:Style;\n\tprivate ground:Sprite;\n\tprivate skyBox:Skybox;\n\n\tprivate _timer:RequestAnimationFrame;\n\tprivate _time:number = 0;\n\n\t/**\n\t * Constructor\n\t */\n\tconstructor()\n\t{\n\t\tthis.init();\n\t}\n\n\t/**\n\t * Global initialise function\n\t */\n\tprivate init():void\n\t{\n\t\tthis.initEngine();\n\t\t//this.initText();\n\t\tthis.initLights();\n\t\tthis.initMaterials();\n\t\tthis.initObjects();\n\t\tthis.initListeners();\n\t}\n\n\t/**\n\t * Initialise the engine\n\t */\n\tprivate initEngine():void\n\t{\n\t\tthis.view = new View();\n\t\tthis.scene = this.view.scene;\n\t\tthis.camera = this.view.camera;\n\n\t\tthis.camera.projection.far = 5000;\n\t\tthis.camera.z = -200;\n\t\tthis.camera.y = 160;\n\n\t\t//setup controller to be used on the camera\n\t\tthis.placeHolder = new DisplayObjectContainer();\n\t\tthis.placeHolder.y = 50;\n\t\tthis.cameraController = new LookAtController(this.camera, this.placeHolder);\n\t}\n\n\t/**\n\t * Create an instructions overlay\n\t */\n//\t\tprivate initText():void\n//\t\t{\n//\t\t\ttext = new TextField();\n//\t\t\ttext.defaultTextFormat = new TextFormat(\"Verdana\", 11, 0xFFFFFF);\n//\t\t\ttext.width = 240;\n//\t\t\ttext.height = 100;\n//\t\t\ttext.selectable = false;\n//\t\t\ttext.mouseEnabled = false;\n//\t\t\ttext.text = \"Cursor keys / WSAD - move\\n\";\n//\t\t\ttext.appendText(\"SHIFT - hold down to run\\n\");\n//\t\t\ttext.appendText(\"numbers 1-9 - Attack\\n\");\n//\t\t\ttext.filters = [new DropShadowFilter(1, 45, 0x0, 1, 0, 0)];\n//\n//\t\t\taddChild(text);\n//\t\t}\n\n\t/**\n\t * Initialise the entities\n\t */\n\tprivate initLights():void\n\t{\n\t\t//create a light for shadows that mimics the sun's position in the skybox\n\t\tthis.redLight = new PointLight();\n\t\tthis.redLight.x = -1000;\n\t\tthis.redLight.y = 200;\n\t\tthis.redLight.z = -1400;\n\t\tthis.redLight.color = 0xff1111;\n\t\tthis.scene.addChild(this.redLight);\n\n\t\tthis.blueLight = new PointLight();\n\t\tthis.blueLight.x = 1000;\n\t\tthis.blueLight.y = 200;\n\t\tthis.blueLight.z = 1400;\n\t\tthis.blueLight.color = 0x1111ff;\n\t\tthis.scene.addChild(this.blueLight);\n\n\t\tthis.whiteLight = new DirectionalLight(-50, -20, 10);\n\t\tthis.whiteLight.color = 0xffffee;\n\t\tthis.whiteLight.castsShadows = true;\n\t\tthis.whiteLight.ambient = 1;\n\t\tthis.whiteLight.ambientColor = 0x303040;\n\t\tthis.whiteLight.shadowMapper = new NearDirectionalShadowMapper(.2);\n\t\tthis.scene.addChild(this.whiteLight);\n\n\t\tthis.lightPicker = new StaticLightPicker([this.redLight, this.blueLight, this.whiteLight]);\n\n\n\t\t//create a global shadow method\n\t\tthis.shadowMapMethod = new ShadowNearMethod(new ShadowSoftMethod(this.whiteLight, 15, 8));\n\t\tthis.shadowMapMethod.epsilon = .1;\n\n\t\t//create a global fog method\n\t\tthis.fogMethod = new EffectFogMethod(0, this.camera.projection.far*0.5, 0x000000);\n\t}\n\n\t/**\n\t * Initialise the materials\n\t */\n\tprivate initMaterials():void\n\t{\n\t\t//red light material\n\t\tthis.redLightMaterial = new MethodMaterial();\n\t\tthis.redLightMaterial.alphaBlending = true;\n\t\tthis.redLightMaterial.addEffectMethod(this.fogMethod);\n\n\t\t//blue light material\n\t\tthis.blueLightMaterial = new MethodMaterial();\n\t\tthis.blueLightMaterial.alphaBlending = true;\n\t\tthis.blueLightMaterial.addEffectMethod(this.fogMethod);\n\n\t\t//ground material\n\t\tthis.groundMaterial = new MethodMaterial();\n\t\tthis.groundMaterial.style.sampler = new Sampler2D(true, true);\n\t\tthis.groundMaterial.lightPicker = this.lightPicker;\n\t\tthis.groundMaterial.shadowMethod = this.shadowMapMethod;\n\t\tthis.groundMaterial.addEffectMethod(this.fogMethod);\n\n\t\t//body material\n\t\tthis.bodyMaterial = new MethodMaterial();\n\t\tthis.bodyMaterial.specularMethod.gloss = 20;\n\t\tthis.bodyMaterial.specularMethod.strength = 1.5;\n\t\tthis.bodyMaterial.addEffectMethod(this.fogMethod);\n\t\tthis.bodyMaterial.lightPicker = this.lightPicker;\n\t\tthis.bodyMaterial.shadowMethod = this.shadowMapMethod;\n\n\t\t//gob material\n\t\tthis.gobMaterial = new MethodMaterial();\n\t\tthis.gobMaterial.alphaBlending = true;\n\t\tthis.gobMaterial.style.sampler = new Sampler2D(true, true);\n\t\tthis.gobMaterial.animateUVs = true;\n\t\tthis.gobMaterial.addEffectMethod(this.fogMethod);\n\t\tthis.gobMaterial.lightPicker = this.lightPicker;\n\t\tthis.gobMaterial.shadowMethod = this.shadowMapMethod;\n\t}\n\n\t/**\n\t * Initialise the scene objects\n\t */\n\tprivate initObjects():void\n\t{\n\t\t//create light billboards\n\t\tvar redSprite:Billboard = new Billboard(this.redLightMaterial);\n\t\tredSprite.width = 200;\n\t\tredSprite.height = 200;\n\t\tredSprite.castsShadows = false;\n\t\tvar blueSprite:Billboard = new Billboard(this.blueLightMaterial);\n\t\tblueSprite.width = 200;\n\t\tblueSprite.height = 200;\n\t\tblueSprite.castsShadows = false;\n\t\tthis.redLight.addChild(redSprite);\n\t\tthis.blueLight.addChild(blueSprite);\n\n\t\tAssetLibrary.enableParser(MD5MeshParser);\n\t\tAssetLibrary.enableParser(MD5AnimParser);\n\n\t\t//create a rocky ground plane\n\t\tthis.ground = <Sprite> new PrimitivePlanePrefab(this.groundMaterial, ElementsType.TRIANGLE, 50000, 50000, 1, 1).getNewObject();\n\t\tthis.ground.graphics.scaleUV(200, 200);\n\t\tthis.ground.castsShadows = false;\n\t\tthis.scene.addChild(this.ground);\n\t}\n\n\t/**\n\t * Initialise the listeners\n\t */\n\tprivate initListeners():void\n\t{\n\t\twindow.onresize  = (event) => this.onResize(event);\n\t\tdocument.onkeydown = (event) => this.onKeyDown(event);\n\t\tdocument.onkeyup = (event) => this.onKeyUp(event);\n\n\t\tthis.onResize();\n\n\t\tthis._timer = new RequestAnimationFrame(this.onEnterFrame, this);\n\t\tthis._timer.start();\n\n\t\t//setup the url map for textures in the cubemap file\n\t\tvar loaderContext:LoaderContext = new LoaderContext();\n\t\tloaderContext.dependencyBaseUrl = \"assets/skybox/\";\n\n\t\t//load hellknight sprite\n\t\tAssetLibrary.addEventListener(AssetEvent.ASSET_COMPLETE, (event:AssetEvent) => this.onAssetComplete(event));\n\t\tAssetLibrary.addEventListener(LoaderEvent.LOAD_COMPLETE, (event:LoaderEvent) => this.onResourceComplete(event));\n\t\tAssetLibrary.load(new URLRequest(\"assets/hellknight/hellknight.md5mesh\"), null, null, new MD5MeshParser());\n\n\t\t//load environment texture\n\t\tAssetLibrary.load(new URLRequest(\"assets/skybox/grimnight_texture.cube\"), loaderContext);\n\n\t\t//load light textures\n\t\tAssetLibrary.load(new URLRequest(\"assets/redlight.png\"));\n\t\tAssetLibrary.load(new URLRequest(\"assets/bluelight.png\"));\n\n\t\t//load floor textures\n\t\tAssetLibrary.load(new URLRequest(\"assets/rockbase_diffuse.jpg\"));\n\t\tAssetLibrary.load(new URLRequest(\"assets/rockbase_normals.png\"));\n\t\tAssetLibrary.load(new URLRequest(\"assets/rockbase_specular.png\"));\n\n\t\t//load hellknight textures\n\t\tAssetLibrary.load(new URLRequest(\"assets/hellknight/hellknight_diffuse.jpg\"));\n\t\tAssetLibrary.load(new URLRequest(\"assets/hellknight/hellknight_normals.png\"));\n\t\tAssetLibrary.load(new URLRequest(\"assets/hellknight/hellknight_specular.png\"));\n\t\tAssetLibrary.load(new URLRequest(\"assets/hellknight/gob.png\"));\n\t}\n\n\t/**\n\t * Navigation and render loop\n\t */\n\tprivate onEnterFrame(dt:number):void\n\t{\n\t\tthis._time += dt;\n\n\t\tthis.cameraController.update();\n\n\t\t//update character animation\n\t\tif (this.sprite) {\n\t\t\tthis.gobStyle.uvMatrix.ty = (-this._time/2000 % 1);\n\t\t\tthis.sprite.rotationY += this.currentRotationInc;\n\t\t}\n\n\t\tthis.count += 0.01;\n\n\t\tthis.redLight.x = Math.sin(this.count)*1500;\n\t\tthis.redLight.y = 250 + Math.sin(this.count*0.54)*200;\n\t\tthis.redLight.z = Math.cos(this.count*0.7)*1500;\n\t\tthis.blueLight.x = -Math.sin(this.count*0.8)*1500;\n\t\tthis.blueLight.y = 250 - Math.sin(this.count*.65)*200;\n\t\tthis.blueLight.z = -Math.cos(this.count*0.9)*1500;\n\n\t\tthis.view.render();\n\t}\n\n\t/**\n\t * Listener for asset complete event on loader\n\t */\n\tprivate onAssetComplete(event:AssetEvent):void\n\t{\n\t\tif (event.asset.isAsset(AnimationNodeBase)) {\n\n\t\t\tvar node:SkeletonClipNode = <SkeletonClipNode> event.asset;\n\t\t\tvar name:string = event.asset.assetNamespace;\n\n\t\t\tnode.name = name;\n\t\t\tthis.animationSet.addAnimation(node);\n\n\t\t\tif (name == Intermediate_MD5Animation.IDLE_NAME || name == Intermediate_MD5Animation.WALK_NAME) {\n\t\t\t\tnode.looping = true;\n\t\t\t} else {\n\t\t\t\tnode.looping = false;\n\t\t\t\tnode.addEventListener(AnimationStateEvent.PLAYBACK_COMPLETE, (event:AnimationStateEvent) => this.onPlaybackComplete(event));\n\t\t\t}\n\n\t\t\tif (name == Intermediate_MD5Animation.IDLE_NAME)\n\t\t\t\tthis.stop();\n\t\t} else if (event.asset.isAsset(AnimationSetBase)) {\n\t\t\tthis.animationSet = <SkeletonAnimationSet> event.asset;\n\t\t\tthis.animator = new SkeletonAnimator(this.animationSet, this.skeleton);\n\t\t\tfor (var i:number /*uint*/ = 0; i < Intermediate_MD5Animation.ANIM_NAMES.length; ++i)\n\t\t\t\tAssetLibrary.load(new URLRequest(\"assets/hellknight/\" + Intermediate_MD5Animation.ANIM_NAMES[i] + \".md5anim\"), null, Intermediate_MD5Animation.ANIM_NAMES[i], new MD5AnimParser());\n\n\t\t\tthis.sprite.animator = this.animator;\n\t\t} else if (event.asset.isAsset(Skeleton)) {\n\t\t\tthis.skeleton = <Skeleton> event.asset;\n\t\t} else if (event.asset.isAsset(Sprite)) {\n\t\t\t//grab sprite object and assign our material object\n\t\t\tthis.sprite = <Sprite> event.asset;\n\t\t\tthis.sprite.graphics.getShapeAt(0).material = this.bodyMaterial;\n\t\t\tthis.sprite.graphics.getShapeAt(1).material = this.sprite.graphics.getShapeAt(2).material = this.sprite.graphics.getShapeAt(3).material = this.gobMaterial;\n\t\t\tthis.sprite.castsShadows = true;\n\t\t\tthis.sprite.rotationY = 180;\n\t\t\tthis.gobStyle = this.sprite.graphics.getShapeAt(1).style = this.sprite.graphics.getShapeAt(2).style = this.sprite.graphics.getShapeAt(3).style = new Style();\n\t\t\tthis.gobStyle.uvMatrix = new Matrix();\n\t\t\tthis.scene.addChild(this.sprite);\n\n\t\t\t//add our lookat object to the sprite\n\t\t\tthis.sprite.addChild(this.placeHolder);\n\t\t}\n\t}\n\n\t/**\n\t * Listener function for resource complete event on asset library\n\t */\n\tprivate onResourceComplete (event:LoaderEvent)\n\t{\n\t\tswitch( event.url )\n\t\t{\n\t\t\t//environment texture\n\t\t\tcase 'assets/skybox/grimnight_texture.cube':\n\t\t\t\tthis.skyBox = new Skybox(<BitmapImageCube> event.assets[0]);\n\t\t\t\tthis.scene.addChild(this.skyBox);\n\t\t\t\tbreak;\n\n\t\t\t//entities textures\n\t\t\tcase \"assets/redlight.png\" :\n\t\t\t\tthis.redLightMaterial.ambientMethod.texture = new Single2DTexture(<BitmapImage2D> event.assets[0]);\n\t\t\t\tbreak;\n\t\t\tcase \"assets/bluelight.png\" :\n\t\t\t\tthis.blueLightMaterial.ambientMethod.texture = new Single2DTexture(<BitmapImage2D> event.assets[0]);\n\t\t\t\tbreak;\n\n\t\t\t//floor textures\n\t\t\tcase \"assets/rockbase_diffuse.jpg\" :\n\t\t\t\tthis.groundMaterial.ambientMethod.texture = new Single2DTexture(<BitmapImage2D> event.assets[0]);\n\t\t\t\tbreak;\n\t\t\tcase \"assets/rockbase_normals.png\" :\n\t\t\t\tthis.groundMaterial.normalMethod.texture = new Single2DTexture(<BitmapImage2D> event.assets[0]);\n\t\t\t\tbreak;\n\t\t\tcase \"assets/rockbase_specular.png\" :\n\t\t\t\tthis.groundMaterial.specularMethod.texture = new Single2DTexture(<BitmapImage2D> event.assets[0]);\n\t\t\t\tbreak;\n\n\t\t\t//hellknight textures\n\t\t\tcase \"assets/hellknight/hellknight_diffuse.jpg\" :\n\t\t\t\tthis.bodyMaterial.ambientMethod.texture = new Single2DTexture(<BitmapImage2D> event.assets[0]);\n\t\t\t\tbreak;\n\t\t\tcase \"assets/hellknight/hellknight_normals.png\" :\n\t\t\t\tthis.bodyMaterial.normalMethod.texture = new Single2DTexture(<BitmapImage2D> event.assets[0]);\n\t\t\t\tbreak;\n\t\t\tcase \"assets/hellknight/hellknight_specular.png\" :\n\t\t\t\tthis.bodyMaterial.specularMethod.texture = new Single2DTexture(<BitmapImage2D> event.assets[0]);\n\t\t\t\tbreak;\n\t\t\tcase \"assets/hellknight/gob.png\" :\n\t\t\t\tthis.gobMaterial.specularMethod.texture = this.gobMaterial.ambientMethod.texture = new Single2DTexture(<BitmapImage2D> event.assets[0]);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate onPlaybackComplete(event:AnimationStateEvent):void\n\t{\n\t\tif (this.animator.activeState != event.animationState)\n\t\t\treturn;\n\n\t\tthis.onceAnim = null;\n\n\t\tthis.animator.play(this.currentAnim, this.stateTransition);\n\t\tthis.animator.playbackSpeed = this.isMoving? this.movementDirection*(this.isRunning? Intermediate_MD5Animation.RUN_SPEED : Intermediate_MD5Animation.WALK_SPEED) : Intermediate_MD5Animation.IDLE_SPEED;\n\t}\n\n\tprivate playAction(val:number /*uint*/):void\n\t{\n\t\tthis.onceAnim = Intermediate_MD5Animation.ANIM_NAMES[val + 2];\n\t\tthis.animator.playbackSpeed = Intermediate_MD5Animation.ACTION_SPEED;\n\t\tthis.animator.play(this.onceAnim, this.stateTransition, 0);\n\t}\n\n\t/**\n\t * Key up listener\n\t */\n\tprivate onKeyDown(event):void\n\t{\n\t\tswitch (event.keyCode) {\n\t\t\tcase Keyboard.SHIFT:\n\t\t\t\tthis.isRunning = true;\n\t\t\t\tif (this.isMoving)\n\t\t\t\t\tthis.updateMovement(this.movementDirection);\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.UP:\n\t\t\tcase Keyboard.W:\n\t\t\tcase Keyboard.Z: //fr\n\t\t\t\tthis.updateMovement(this.movementDirection = 1);\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.DOWN:\n\t\t\tcase Keyboard.S:\n\t\t\t\tthis.updateMovement(this.movementDirection = -1);\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.LEFT:\n\t\t\tcase Keyboard.A:\n\t\t\tcase Keyboard.Q: //fr\n\t\t\t\tthis.currentRotationInc = -Intermediate_MD5Animation.ROTATION_SPEED;\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.RIGHT:\n\t\t\tcase Keyboard.D:\n\t\t\t\tthis.currentRotationInc = Intermediate_MD5Animation.ROTATION_SPEED;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Key down listener for animation\n\t */\n\tprivate onKeyUp(event):void\n\t{\n\t\tswitch (event.keyCode) {\n\t\t\tcase Keyboard.SHIFT:\n\t\t\t\tthis.isRunning = false;\n\t\t\t\tif (this.isMoving)\n\t\t\t\t\tthis.updateMovement(this.movementDirection);\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.UP:\n\t\t\tcase Keyboard.W:\n\t\t\tcase Keyboard.Z: //fr\n\t\t\tcase Keyboard.DOWN:\n\t\t\tcase Keyboard.S:\n\t\t\t\tthis.stop();\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.LEFT:\n\t\t\tcase Keyboard.A:\n\t\t\tcase Keyboard.Q: //fr\n\t\t\tcase Keyboard.RIGHT:\n\t\t\tcase Keyboard.D:\n\t\t\t\tthis.currentRotationInc = 0;\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.NUMBER_1:\n\t\t\t\tthis.playAction(1);\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.NUMBER_2:\n\t\t\t\tthis.playAction(2);\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.NUMBER_3:\n\t\t\t\tthis.playAction(3);\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.NUMBER_4:\n\t\t\t\tthis.playAction(4);\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.NUMBER_5:\n\t\t\t\tthis.playAction(5);\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.NUMBER_6:\n\t\t\t\tthis.playAction(6);\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.NUMBER_7:\n\t\t\t\tthis.playAction(7);\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.NUMBER_8:\n\t\t\t\tthis.playAction(8);\n\t\t\t\tbreak;\n\t\t\tcase Keyboard.NUMBER_9:\n\t\t\t\tthis.playAction(9);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate updateMovement(dir:number):void\n\t{\n\t\tthis.isMoving = true;\n\t\tthis.animator.playbackSpeed = dir*(this.isRunning? Intermediate_MD5Animation.RUN_SPEED : Intermediate_MD5Animation.WALK_SPEED);\n\n\t\tif (this.currentAnim == Intermediate_MD5Animation.WALK_NAME)\n\t\t\treturn;\n\n\t\tthis.currentAnim = Intermediate_MD5Animation.WALK_NAME;\n\n\t\tif (this.onceAnim)\n\t\t\treturn;\n\n\t\t//update animator\n\t\tthis.animator.play(this.currentAnim, this.stateTransition);\n\t}\n\n\tprivate stop():void\n\t{\n\t\tthis.isMoving = false;\n\n\t\tif (this.currentAnim == Intermediate_MD5Animation.IDLE_NAME)\n\t\t\treturn;\n\n\t\tthis.currentAnim = Intermediate_MD5Animation.IDLE_NAME;\n\n\t\tif (this.onceAnim)\n\t\t\treturn;\n\n\t\t//update animator\n\t\tthis.animator.playbackSpeed = Intermediate_MD5Animation.IDLE_SPEED;\n\t\tthis.animator.play(this.currentAnim, this.stateTransition);\n\t}\n\n\t/**\n\t * stage listener for resize events\n\t */\n\tprivate onResize(event:Event = null):void\n\t{\n\t\tthis.view.width = window.innerWidth;\n\t\tthis.view.height = window.innerHeight;\n\t}\n}\n\n\nwindow.onload = function ()\n{\n\tnew Intermediate_MD5Animation();\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/Intermediate_MD5Animation.ts"],"sourceRoot":""}