/*

AWD3 file loading example in AwayJS

Demonstrates:

How to use the Loader object to load an embedded internal awd model.

Code by Rob Bateman
rob@infiniteturtles.co.uk
http://www.infiniteturtles.co.uk

This code is distributed under the MIT License

Copyright (c) The Away Foundation http://www.theawayfoundation.org

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the “Software”), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/
var AssetLibrary = require("awayjs-core/lib/library/AssetLibrary");
var AssetType = require("awayjs-core/lib/library/AssetType");
var AssetEvent = require("awayjs-core/lib/events/AssetEvent");
var URLRequest = require("awayjs-core/lib/net/URLRequest");
var LoaderEvent = require("awayjs-core/lib/events/LoaderEvent");
var OrthographicProjection = require("awayjs-core/lib/projections/OrthographicProjection");
var RequestAnimationFrame = require("awayjs-core/lib/utils/RequestAnimationFrame");
var View = require("awayjs-display/lib/containers/View");
var Loader = require("awayjs-display/lib/containers/Loader");
var DefaultRenderer = require("awayjs-renderergl/lib/DefaultRenderer");
var MethodRendererPool = require("awayjs-methodmaterials/lib/pool/MethodRendererPool");
var AWDParser = require("awayjs-parsers/lib/AWDParser");
var AWD3Viewer = (function () {
    /**
     * Constructor
     */
    function AWD3Viewer() {
        this._time = 0;
        this.init();
    }
    /**
     * Global initialise function
     */
    AWD3Viewer.prototype.init = function () {
        this.initEngine();
        this.initObjects();
        this.initListeners();
    };
    /**
     * Initialise the engine
     */
    AWD3Viewer.prototype.initEngine = function () {
        //create the view
        this._view = new View(new DefaultRenderer(MethodRendererPool));
        this._view.backgroundColor = 0xffffff;
        this._view.camera.projection = new OrthographicProjection(500);
        this._view.camera.projection.far = 500000;
        this._view.camera.projection.near = 0.1;
        this._view.camera.x = 0;
        this._view.camera.y = 0;
        this._view.camera.z = 300;
        this._view.camera.rotationX = -180;
        this._view.camera.rotationY = 0;
        this._view.camera.rotationZ = -180;
        //create custom lens
        // this._view.camera.projection = new OrthographicOffCenterProjection(0, 550, -400, 0);
        //  this._view.camera.projection.far = 500000;
        //  this._view.camera.projection.near = 0.1;
        /*
            //setup controller to be used on the camera
            this._cameraController = new HoverController(this._view.camera, null, 0, 0, 300, 10, 90);
            this._cameraController.lookAtPosition = new Vector3D(0, 50, 0);
            this._cameraController.tiltAngle = 0;
            this._cameraController.panAngle = 0;
            this._cameraController.minTiltAngle = 5;
            this._cameraController.maxTiltAngle = 60;
            this._cameraController.autoUpdate = false;
        */
    };
    /**
     * Initialise the scene objects
     */
    AWD3Viewer.prototype.initObjects = function () {
        var _this = this;
        AssetLibrary.enableParser(AWDParser);
        //kickoff asset loading
        var loader = new Loader();
        loader.addEventListener(AssetEvent.ASSET_COMPLETE, function (event) { return _this.onAssetComplete(event); });
        loader.addEventListener(LoaderEvent.RESOURCE_COMPLETE, function (event) { return _this.onRessourceComplete(event); });
        /*
        var _cube:PrimitiveCubePrefab = new PrimitiveCubePrefab(20.0, 20.0, 20.0);
        var newmesh2:Mesh=< Mesh>_cube.getNewObject();
        // newmesh2.material=new ColorMaterial(0xff0000, 1.0);
        //newmesh2.material.bothSides=true;
        var matTx:MethodMaterial = new MethodMaterial (0xFF0000);
        matTx.bothSides = true;
        newmesh2.material=matTx;
        this._view.scene.addChild(newmesh2);
        console.log("LOADET A Geom name = ")*/
        loader.load(new URLRequest(document.getElementById("awdPath").innerHTML));
        //loader.load(new URLRequest("assets/AWD3/ScareCrow.awd"));
        //loader.load(new URLRequest("assets/AWD3/NestedTween.awd"));
        //loader.load(new URLRequest("assets/AWD3/Simple_shape_new.awd"));
        // console.log("START LOADING");
        //this._view.scene.addChild(loader);
    };
    /**
     * Initialise the listeners
     */
    AWD3Viewer.prototype.initListeners = function () {
        var _this = this;
        window.onresize = function (event) { return _this.onResize(event); };
        document.onkeydown = function (event) { return _this.onKeyDown(event); };
        document.onmousedown = function (event) { return _this.onMouseDown(event); };
        document.onmouseup = function (event) { return _this.onMouseUp(event); };
        document.onmousemove = function (event) { return _this.onMouseMove(event); };
        document.onmousewheel = function (event) { return _this.onMouseWheel(event); };
        this.onResize();
        this._timer = new RequestAnimationFrame(this.onEnterFrame, this);
        this._timer.start();
    };
    /**
     * loader listener for asset complete events
     */
    AWD3Viewer.prototype.onAssetComplete = function (event) {
        if (event.asset.assetType == AssetType.TIMELINE) {
            this._rootTimeLine = event.asset;
        }
    };
    /**
     * loader listener for asset complete events
     */
    AWD3Viewer.prototype.onRessourceComplete = function (event) {
        if (this._rootTimeLine) {
            //console.log("LOADING A ROOT name = " + this._rootTimeLine.name + " duration=" + this._rootTimeLine.duration);
            this._view.scene.addChild(this._rootTimeLine);
        }
    };
    /**
     * Render loop
     */
    AWD3Viewer.prototype.onEnterFrame = function (dt) {
        this._time += dt;
        //update camera controler
        // this._cameraController.update();
        if (this._rootTimeLine != undefined) {
            //console.log("RENDER = ");
            this._rootTimeLine.update(dt);
        }
        //console.log("RENDER = ");
        //update view
        this._view.render();
    };
    AWD3Viewer.prototype.onKeyDown = function (event) {
        if (event.keyCode == 109) {
            var test = this._view.camera.projection;
            test.projectionHeight += 5;
        }
        else if (event.keyCode == 107) {
            var test = this._view.camera.projection;
            test.projectionHeight -= 5;
        }
    };
    AWD3Viewer.prototype.onMouseDown = function (event) {
        /*  this._lastPanAngle = this._cameraController.panAngle;
          this._lastTiltAngle = this._cameraController.tiltAngle;
          this._move = true;*/
        this._lastMouseX = event.clientX;
        this._lastMouseY = event.clientY;
        this._move = true;
    };
    AWD3Viewer.prototype.onMouseUp = function (event) {
        this._move = false;
    };
    AWD3Viewer.prototype.onMouseMove = function (event) {
        if (this._move) {
            if (event.clientX > (this._lastMouseX + 10))
                this._view.camera.x += 10;
            else if (event.clientX > this._lastMouseX)
                this._view.camera.x++;
            else if (event.clientX < (this._lastMouseX - 10))
                this._view.camera.x -= 10;
            else if (event.clientX < this._lastMouseX)
                this._view.camera.x--;
            if (event.clientY > (this._lastMouseY + 10))
                this._view.camera.y += 10;
            else if (event.clientY > this._lastMouseY)
                this._view.camera.y++;
            else if (event.clientY < (this._lastMouseY - 10))
                this._view.camera.y -= 10;
            else if (event.clientY < this._lastMouseY)
                this._view.camera.y--;
            this._lastMouseX = event.clientX;
            this._lastMouseY = event.clientY;
        }
    };
    AWD3Viewer.prototype.onMouseWheel = function (event) {
        /* this._cameraController.distance -= event.wheelDelta * 5;
     
         if (this._cameraController.distance < 100) {
           this._cameraController.distance = 100;
         } else if (this._cameraController.distance > 2000) {
           this._cameraController.distance = 2000;
         }
         */
    };
    AWD3Viewer.prototype.onResize = function (event) {
        if (event === void 0) { event = null; }
        this._view.y = 0;
        this._view.x = 0;
        this._view.width = window.innerWidth;
        this._view.height = window.innerHeight;
    };
    return AWD3Viewer;
})();
window.onload = function () {
    new AWD3Viewer();
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9BV0QzVmlld2VyLnRzIl0sIm5hbWVzIjpbIkFXRDNWaWV3ZXIiLCJBV0QzVmlld2VyLmNvbnN0cnVjdG9yIiwiQVdEM1ZpZXdlci5pbml0IiwiQVdEM1ZpZXdlci5pbml0RW5naW5lIiwiQVdEM1ZpZXdlci5pbml0T2JqZWN0cyIsIkFXRDNWaWV3ZXIuaW5pdExpc3RlbmVycyIsIkFXRDNWaWV3ZXIub25Bc3NldENvbXBsZXRlIiwiQVdEM1ZpZXdlci5vblJlc3NvdXJjZUNvbXBsZXRlIiwiQVdEM1ZpZXdlci5vbkVudGVyRnJhbWUiLCJBV0QzVmlld2VyLm9uS2V5RG93biIsIkFXRDNWaWV3ZXIub25Nb3VzZURvd24iLCJBV0QzVmlld2VyLm9uTW91c2VVcCIsIkFXRDNWaWV3ZXIub25Nb3VzZU1vdmUiLCJBV0QzVmlld2VyLm9uTW91c2VXaGVlbCIsIkFXRDNWaWV3ZXIub25SZXNpemUiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0VBa0NFO0FBRUYsSUFBTyxZQUFZLFdBQWUsc0NBQXNDLENBQUMsQ0FBQztBQUMxRSxJQUFPLFNBQVMsV0FBZSxtQ0FBbUMsQ0FBQyxDQUFDO0FBQ3BFLElBQU8sVUFBVSxXQUFlLG1DQUFtQyxDQUFDLENBQUM7QUFDckUsSUFBTyxVQUFVLFdBQWUsZ0NBQWdDLENBQUMsQ0FBQztBQUNsRSxJQUFPLFdBQVcsV0FBZSxvQ0FBb0MsQ0FBQyxDQUFDO0FBR3ZFLElBQU8sc0JBQXNCLFdBQVksb0RBQW9ELENBQUMsQ0FBQztBQUUvRixJQUFPLHFCQUFxQixXQUFZLDZDQUE2QyxDQUFDLENBQUM7QUFFdkYsSUFBTyxJQUFJLFdBQWlCLG9DQUFvQyxDQUFDLENBQUM7QUFLbEUsSUFBTyxNQUFNLFdBQWdCLHNDQUFzQyxDQUFDLENBQUM7QUFJckUsSUFBTyxlQUFlLFdBQWMsdUNBQXVDLENBQUMsQ0FBQztBQUc3RSxJQUFPLGtCQUFrQixXQUFhLG9EQUFvRCxDQUFDLENBQUM7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Z0NBQVdBLEdBQW5CQSxVQUFvQkEsS0FBS0E7UUFFdkJZLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBO1lBQ2JBLEVBQUVBLENBQUNBLENBQUVBLEtBQUtBLENBQUNBLE9BQU9BLEdBQUNBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLEdBQUNBLEVBQUVBLENBQUNBLENBQUNBO2dCQUNyQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsSUFBRUEsRUFBRUEsQ0FBQ0E7WUFDNUJBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUVBLEtBQUtBLENBQUNBLE9BQU9BLEdBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBO2dCQUNyQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0E7WUFDMUJBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUVBLEtBQUtBLENBQUNBLE9BQU9BLEdBQUNBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLEdBQUNBLEVBQUVBLENBQUNBLENBQUNBO2dCQUMxQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsSUFBRUEsRUFBRUEsQ0FBQ0E7WUFDNUJBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUVBLEtBQUtBLENBQUNBLE9BQU9BLEdBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBO2dCQUNyQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0E7WUFDMUJBLEVBQUVBLENBQUNBLENBQUVBLEtBQUtBLENBQUNBLE9BQU9BLEdBQUNBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLEdBQUNBLEVBQUVBLENBQUNBLENBQUNBO2dCQUNyQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsSUFBRUEsRUFBRUEsQ0FBQ0E7WUFDNUJBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUVBLEtBQUtBLENBQUNBLE9BQU9BLEdBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBO2dCQUNyQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0E7WUFDMUJBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUVBLEtBQUtBLENBQUNBLE9BQU9BLEdBQUNBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLEdBQUNBLEVBQUVBLENBQUNBLENBQUNBO2dCQUMxQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsSUFBRUEsRUFBRUEsQ0FBQ0E7WUFDNUJBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUVBLEtBQUtBLENBQUNBLE9BQU9BLEdBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBO2dCQUNyQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0E7WUFDMUJBLElBQUlBLENBQUNBLFdBQVdBLEdBQUdBLEtBQUtBLENBQUNBLE9BQU9BLENBQUNBO1lBQ2pDQSxJQUFJQSxDQUFDQSxXQUFXQSxHQUFHQSxLQUFLQSxDQUFDQSxPQUFPQSxDQUFDQTtRQUdyQ0EsQ0FBQ0E7SUFDSEEsQ0FBQ0E7SUFFT1osaUNBQVlBLEdBQXBCQSxVQUFxQkEsS0FBS0E7UUFHekJhOzs7Ozs7O1dBT0dBO0lBQ0pBLENBQUNBO0lBRU9iLDZCQUFRQSxHQUFoQkEsVUFBaUJBLEtBQVlBO1FBQVpjLHFCQUFZQSxHQUFaQSxZQUFZQTtRQUUzQkEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsR0FBV0EsQ0FBQ0EsQ0FBQ0E7UUFDekJBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLEdBQVdBLENBQUNBLENBQUNBO1FBQ3pCQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxHQUFPQSxNQUFNQSxDQUFDQSxVQUFVQSxDQUFDQTtRQUN6Q0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsR0FBTUEsTUFBTUEsQ0FBQ0EsV0FBV0EsQ0FBQ0E7SUFDNUNBLENBQUNBO0lBRUhkLGlCQUFDQTtBQUFEQSxDQXpPQSxBQXlPQ0EsSUFBQTtBQUVELE1BQU0sQ0FBQyxNQUFNLEdBQUc7SUFDZixJQUFJLFVBQVUsRUFBRSxDQUFDO0FBQ2xCLENBQUMsQ0FBQyIsImZpbGUiOiJBV0QzVmlld2VyLmpzIiwic291cmNlUm9vdCI6Ii4vIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuXHJcbkFXRDMgZmlsZSBsb2FkaW5nIGV4YW1wbGUgaW4gQXdheUpTXHJcblxyXG5EZW1vbnN0cmF0ZXM6XHJcblxyXG5Ib3cgdG8gdXNlIHRoZSBMb2FkZXIgb2JqZWN0IHRvIGxvYWQgYW4gZW1iZWRkZWQgaW50ZXJuYWwgYXdkIG1vZGVsLlxyXG5cclxuQ29kZSBieSBSb2IgQmF0ZW1hblxyXG5yb2JAaW5maW5pdGV0dXJ0bGVzLmNvLnVrXHJcbmh0dHA6Ly93d3cuaW5maW5pdGV0dXJ0bGVzLmNvLnVrXHJcblxyXG5UaGlzIGNvZGUgaXMgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlXHJcblxyXG5Db3B5cmlnaHQgKGMpIFRoZSBBd2F5IEZvdW5kYXRpb24gaHR0cDovL3d3dy50aGVhd2F5Zm91bmRhdGlvbi5vcmdcclxuXHJcblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcclxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUg4oCcU29mdHdhcmXigJ0pLCB0byBkZWFsXHJcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcclxudG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxyXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcclxuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcclxuXHJcblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXHJcbmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxyXG5cclxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIOKAnEFTIElT4oCdLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXHJcbklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxyXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcclxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxyXG5MSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxyXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXHJcblRIRSBTT0ZUV0FSRS5cclxuXHJcbiovXHJcblxyXG5pbXBvcnQgQXNzZXRMaWJyYXJ5XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9saWJyYXJ5L0Fzc2V0TGlicmFyeVwiKTtcclxuaW1wb3J0IEFzc2V0VHlwZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbGlicmFyeS9Bc3NldFR5cGVcIik7XHJcbmltcG9ydCBBc3NldEV2ZW50XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvQXNzZXRFdmVudFwiKTtcclxuaW1wb3J0IFVSTFJlcXVlc3RcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL25ldC9VUkxSZXF1ZXN0XCIpO1xyXG5pbXBvcnQgTG9hZGVyRXZlbnRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2V2ZW50cy9Mb2FkZXJFdmVudFwiKTtcclxuaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vVmVjdG9yM0RcIik7XHJcbmltcG9ydCBPcnRob2dyYXBoaWNPZmZDZW50ZXJQcm9qZWN0aW9uXHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wcm9qZWN0aW9ucy9PcnRob2dyYXBoaWNPZmZDZW50ZXJQcm9qZWN0aW9uXCIpO1xyXG5pbXBvcnQgT3J0aG9ncmFwaGljUHJvamVjdGlvblx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvcHJvamVjdGlvbnMvT3J0aG9ncmFwaGljUHJvamVjdGlvblwiKTtcclxuaW1wb3J0IEtleWJvYXJkXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3VpL0tleWJvYXJkXCIpO1xyXG5pbXBvcnQgUmVxdWVzdEFuaW1hdGlvbkZyYW1lXHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi91dGlscy9SZXF1ZXN0QW5pbWF0aW9uRnJhbWVcIik7XHJcblxyXG5pbXBvcnQgVmlld1x0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2NvbnRhaW5lcnMvVmlld1wiKTtcclxuaW1wb3J0IE1lc2hcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9NZXNoXCIpO1xyXG5pbXBvcnQgQ29udGFpbmVyXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9jb250YWluZXJzL0Rpc3BsYXlPYmplY3RDb250YWluZXJcIik7XHJcbmltcG9ydCBHZW9tZXRyeVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0dlb21ldHJ5XCIpO1xyXG5pbXBvcnQgSG92ZXJDb250cm9sbGVyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvY29udHJvbGxlcnMvSG92ZXJDb250cm9sbGVyXCIpO1xyXG5pbXBvcnQgTG9hZGVyXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2NvbnRhaW5lcnMvTG9hZGVyXCIpO1xyXG5pbXBvcnQgQ29sb3JNYXRlcmlhbFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9CYXNpY01hdGVyaWFsXCIpO1xyXG5pbXBvcnQgUHJpbWl0aXZlQ3ViZVByZWZhYlx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9wcmVmYWJzL1ByaW1pdGl2ZUN1YmVQcmVmYWJcIik7XHJcblxyXG5pbXBvcnQgRGVmYXVsdFJlbmRlcmVyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvRGVmYXVsdFJlbmRlcmVyXCIpO1xyXG5cclxuaW1wb3J0IE1ldGhvZE1hdGVyaWFsXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtbWV0aG9kbWF0ZXJpYWxzL2xpYi9NZXRob2RNYXRlcmlhbFwiKTtcclxuaW1wb3J0IE1ldGhvZFJlbmRlcmVyUG9vbFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1tZXRob2RtYXRlcmlhbHMvbGliL3Bvb2wvTWV0aG9kUmVuZGVyZXJQb29sXCIpO1xyXG5cclxuaW1wb3J0IEFXRFBhcnNlclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcGFyc2Vycy9saWIvQVdEUGFyc2VyXCIpO1xyXG5pbXBvcnQgTW92aWVDbGlwXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1wbGF5ZXIvbGliL2ZsL2Rpc3BsYXkvTW92aWVDbGlwXCIpO1xyXG5cclxuY2xhc3MgQVdEM1ZpZXdlclxyXG57XHJcbiAgLy9lbmdpbmUgdmFyaWFibGVzXHJcbiAgcHJpdmF0ZSBfdmlldzogVmlldztcclxuICBwcml2YXRlIF9jYW1lcmFDb250cm9sbGVyOiBIb3ZlckNvbnRyb2xsZXI7XHJcblxyXG4gIHByaXZhdGUgX3Jvb3RUaW1lTGluZTogTW92aWVDbGlwO1xyXG5cclxuICBwcml2YXRlIF90aW1lcjogUmVxdWVzdEFuaW1hdGlvbkZyYW1lO1xyXG4gIHByaXZhdGUgX3RpbWU6IG51bWJlciA9IDA7XHJcblxyXG4gIC8vbmF2aWdhdGlvblxyXG4gIHByaXZhdGUgX2xhc3RQYW5BbmdsZTogbnVtYmVyO1xyXG4gIHByaXZhdGUgX2xhc3RUaWx0QW5nbGU6IG51bWJlcjtcclxuICBwcml2YXRlIF9sYXN0TW91c2VYOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBfbGFzdE1vdXNlWTogbnVtYmVyO1xyXG4gIHByaXZhdGUgX21vdmU6IGJvb2xlYW47XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbnN0cnVjdG9yXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoKVxyXG4gIHtcclxuICAgIHRoaXMuaW5pdCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2xvYmFsIGluaXRpYWxpc2UgZnVuY3Rpb25cclxuICAgKi9cclxuICBwcml2YXRlIGluaXQoKTogdm9pZFxyXG4gIHtcclxuICAgIHRoaXMuaW5pdEVuZ2luZSgpO1xyXG4gICAgdGhpcy5pbml0T2JqZWN0cygpO1xyXG4gICAgdGhpcy5pbml0TGlzdGVuZXJzKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJbml0aWFsaXNlIHRoZSBlbmdpbmVcclxuICAgKi9cclxuICBwcml2YXRlIGluaXRFbmdpbmUoKTogdm9pZFxyXG4gIHtcclxuICAgIC8vY3JlYXRlIHRoZSB2aWV3XHJcbiAgICB0aGlzLl92aWV3ID0gbmV3IFZpZXcobmV3IERlZmF1bHRSZW5kZXJlcihNZXRob2RSZW5kZXJlclBvb2wpKTtcclxuICAgIHRoaXMuX3ZpZXcuYmFja2dyb3VuZENvbG9yID0gMHhmZmZmZmY7XHJcblxyXG4gICAgICB0aGlzLl92aWV3LmNhbWVyYS5wcm9qZWN0aW9uID0gbmV3IE9ydGhvZ3JhcGhpY1Byb2plY3Rpb24oNTAwKTtcclxuICAgICAgdGhpcy5fdmlldy5jYW1lcmEucHJvamVjdGlvbi5mYXIgPSA1MDAwMDA7XHJcbiAgICAgIHRoaXMuX3ZpZXcuY2FtZXJhLnByb2plY3Rpb24ubmVhciA9IDAuMTtcclxuICAgICAgdGhpcy5fdmlldy5jYW1lcmEueD0wO1xyXG4gICAgICB0aGlzLl92aWV3LmNhbWVyYS55PTA7XHJcbiAgICAgIHRoaXMuX3ZpZXcuY2FtZXJhLno9MzAwO1xyXG4gICAgICB0aGlzLl92aWV3LmNhbWVyYS5yb3RhdGlvblg9LTE4MDtcclxuICAgICAgdGhpcy5fdmlldy5jYW1lcmEucm90YXRpb25ZPTA7XHJcbiAgICAgIHRoaXMuX3ZpZXcuY2FtZXJhLnJvdGF0aW9uWj0tMTgwO1xyXG4gICAgLy9jcmVhdGUgY3VzdG9tIGxlbnNcclxuICAgLy8gdGhpcy5fdmlldy5jYW1lcmEucHJvamVjdGlvbiA9IG5ldyBPcnRob2dyYXBoaWNPZmZDZW50ZXJQcm9qZWN0aW9uKDAsIDU1MCwgLTQwMCwgMCk7XHJcbiAgLy8gIHRoaXMuX3ZpZXcuY2FtZXJhLnByb2plY3Rpb24uZmFyID0gNTAwMDAwO1xyXG4gIC8vICB0aGlzLl92aWV3LmNhbWVyYS5wcm9qZWN0aW9uLm5lYXIgPSAwLjE7XHJcblxyXG4vKlxyXG4gICAgLy9zZXR1cCBjb250cm9sbGVyIHRvIGJlIHVzZWQgb24gdGhlIGNhbWVyYVxyXG4gICAgdGhpcy5fY2FtZXJhQ29udHJvbGxlciA9IG5ldyBIb3ZlckNvbnRyb2xsZXIodGhpcy5fdmlldy5jYW1lcmEsIG51bGwsIDAsIDAsIDMwMCwgMTAsIDkwKTtcclxuICAgIHRoaXMuX2NhbWVyYUNvbnRyb2xsZXIubG9va0F0UG9zaXRpb24gPSBuZXcgVmVjdG9yM0QoMCwgNTAsIDApO1xyXG4gICAgdGhpcy5fY2FtZXJhQ29udHJvbGxlci50aWx0QW5nbGUgPSAwO1xyXG4gICAgdGhpcy5fY2FtZXJhQ29udHJvbGxlci5wYW5BbmdsZSA9IDA7XHJcbiAgICB0aGlzLl9jYW1lcmFDb250cm9sbGVyLm1pblRpbHRBbmdsZSA9IDU7XHJcbiAgICB0aGlzLl9jYW1lcmFDb250cm9sbGVyLm1heFRpbHRBbmdsZSA9IDYwO1xyXG4gICAgdGhpcy5fY2FtZXJhQ29udHJvbGxlci5hdXRvVXBkYXRlID0gZmFsc2U7XHJcbiovXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJbml0aWFsaXNlIHRoZSBzY2VuZSBvYmplY3RzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbml0T2JqZWN0cygpOiB2b2lkXHJcbiAge1xyXG4gICAgQXNzZXRMaWJyYXJ5LmVuYWJsZVBhcnNlcihBV0RQYXJzZXIpO1xyXG5cclxuICAgIC8va2lja29mZiBhc3NldCBsb2FkaW5nXHJcbiAgICB2YXIgbG9hZGVyOkxvYWRlciA9IG5ldyBMb2FkZXIoKTtcclxuICAgIGxvYWRlci5hZGRFdmVudExpc3RlbmVyKEFzc2V0RXZlbnQuQVNTRVRfQ09NUExFVEUsIChldmVudDogQXNzZXRFdmVudCkgPT4gdGhpcy5vbkFzc2V0Q29tcGxldGUoZXZlbnQpKTtcclxuICAgIGxvYWRlci5hZGRFdmVudExpc3RlbmVyKExvYWRlckV2ZW50LlJFU09VUkNFX0NPTVBMRVRFLCAoZXZlbnQ6IExvYWRlckV2ZW50KSA9PiB0aGlzLm9uUmVzc291cmNlQ29tcGxldGUoZXZlbnQpKTtcclxuXHJcbiAgICAvKlxyXG4gICAgdmFyIF9jdWJlOlByaW1pdGl2ZUN1YmVQcmVmYWIgPSBuZXcgUHJpbWl0aXZlQ3ViZVByZWZhYigyMC4wLCAyMC4wLCAyMC4wKTtcclxuICAgIHZhciBuZXdtZXNoMjpNZXNoPTwgTWVzaD5fY3ViZS5nZXROZXdPYmplY3QoKTtcclxuICAgIC8vIG5ld21lc2gyLm1hdGVyaWFsPW5ldyBDb2xvck1hdGVyaWFsKDB4ZmYwMDAwLCAxLjApO1xyXG4gICAgLy9uZXdtZXNoMi5tYXRlcmlhbC5ib3RoU2lkZXM9dHJ1ZTtcclxuICAgIHZhciBtYXRUeDpNZXRob2RNYXRlcmlhbCA9IG5ldyBNZXRob2RNYXRlcmlhbCAoMHhGRjAwMDApO1xyXG4gICAgbWF0VHguYm90aFNpZGVzID0gdHJ1ZTtcclxuICAgIG5ld21lc2gyLm1hdGVyaWFsPW1hdFR4O1xyXG4gICAgdGhpcy5fdmlldy5zY2VuZS5hZGRDaGlsZChuZXdtZXNoMik7XHJcbiAgICBjb25zb2xlLmxvZyhcIkxPQURFVCBBIEdlb20gbmFtZSA9IFwiKSovXHJcbiAgICBsb2FkZXIubG9hZChuZXcgVVJMUmVxdWVzdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImF3ZFBhdGhcIikuaW5uZXJIVE1MKSk7XHJcbiAgICAvL2xvYWRlci5sb2FkKG5ldyBVUkxSZXF1ZXN0KFwiYXNzZXRzL0FXRDMvU2NhcmVDcm93LmF3ZFwiKSk7XHJcbiAgICAvL2xvYWRlci5sb2FkKG5ldyBVUkxSZXF1ZXN0KFwiYXNzZXRzL0FXRDMvTmVzdGVkVHdlZW4uYXdkXCIpKTtcclxuICAgIC8vbG9hZGVyLmxvYWQobmV3IFVSTFJlcXVlc3QoXCJhc3NldHMvQVdEMy9TaW1wbGVfc2hhcGVfbmV3LmF3ZFwiKSk7XHJcbiAgICAvLyBjb25zb2xlLmxvZyhcIlNUQVJUIExPQURJTkdcIik7XHJcbiAgICAvL3RoaXMuX3ZpZXcuc2NlbmUuYWRkQ2hpbGQobG9hZGVyKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEluaXRpYWxpc2UgdGhlIGxpc3RlbmVyc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5pdExpc3RlbmVycygpOiB2b2lkXHJcbiAge1xyXG4gICAgd2luZG93Lm9ucmVzaXplICA9IChldmVudCkgPT4gdGhpcy5vblJlc2l6ZShldmVudCk7XHJcblxyXG4gICAgICBkb2N1bWVudC5vbmtleWRvd24gPSAoZXZlbnQpID0+IHRoaXMub25LZXlEb3duKGV2ZW50KTtcclxuICAgIGRvY3VtZW50Lm9ubW91c2Vkb3duID0gKGV2ZW50KSA9PiB0aGlzLm9uTW91c2VEb3duKGV2ZW50KTtcclxuICAgIGRvY3VtZW50Lm9ubW91c2V1cCA9IChldmVudCkgPT4gdGhpcy5vbk1vdXNlVXAoZXZlbnQpO1xyXG4gICAgZG9jdW1lbnQub25tb3VzZW1vdmUgPSAoZXZlbnQpID0+IHRoaXMub25Nb3VzZU1vdmUoZXZlbnQpO1xyXG4gICAgZG9jdW1lbnQub25tb3VzZXdoZWVsID0gKGV2ZW50KSA9PiB0aGlzLm9uTW91c2VXaGVlbChldmVudCk7XHJcblxyXG4gICAgdGhpcy5vblJlc2l6ZSgpO1xyXG5cclxuICAgIHRoaXMuX3RpbWVyID0gbmV3IFJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLm9uRW50ZXJGcmFtZSwgdGhpcyk7XHJcbiAgICB0aGlzLl90aW1lci5zdGFydCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogbG9hZGVyIGxpc3RlbmVyIGZvciBhc3NldCBjb21wbGV0ZSBldmVudHNcclxuICAgKi9cclxuICBwcml2YXRlIG9uQXNzZXRDb21wbGV0ZShldmVudDogQXNzZXRFdmVudCk6IHZvaWRcclxuICB7XHJcbiAgICBpZihldmVudC5hc3NldC5hc3NldFR5cGUgPT0gQXNzZXRUeXBlLlRJTUVMSU5FKSB7XHJcbiAgICAgIHRoaXMuX3Jvb3RUaW1lTGluZSA9IDxNb3ZpZUNsaXA+IGV2ZW50LmFzc2V0O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogbG9hZGVyIGxpc3RlbmVyIGZvciBhc3NldCBjb21wbGV0ZSBldmVudHNcclxuICAgKi9cclxuICBwcml2YXRlIG9uUmVzc291cmNlQ29tcGxldGUoZXZlbnQ6IExvYWRlckV2ZW50KTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5fcm9vdFRpbWVMaW5lKSB7XHJcbiAgICAgIC8vY29uc29sZS5sb2coXCJMT0FESU5HIEEgUk9PVCBuYW1lID0gXCIgKyB0aGlzLl9yb290VGltZUxpbmUubmFtZSArIFwiIGR1cmF0aW9uPVwiICsgdGhpcy5fcm9vdFRpbWVMaW5lLmR1cmF0aW9uKTtcclxuICAgICAgdGhpcy5fdmlldy5zY2VuZS5hZGRDaGlsZCh0aGlzLl9yb290VGltZUxpbmUpO1xyXG4gICAgICAvLyBhdXRvcGxheSBsaWtlIGluIEZsYXNoXHJcbiAgICAgIC8vdGhpcy5fcm9vdFRpbWVMaW5lLnBsYXkoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbmRlciBsb29wXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBvbkVudGVyRnJhbWUoZHQ6IG51bWJlcik6IHZvaWQge1xyXG4gICAgdGhpcy5fdGltZSArPSBkdDtcclxuXHJcbiAgICAvL3VwZGF0ZSBjYW1lcmEgY29udHJvbGVyXHJcbiAgIC8vIHRoaXMuX2NhbWVyYUNvbnRyb2xsZXIudXBkYXRlKCk7XHJcblxyXG4gICAgaWYgKHRoaXMuX3Jvb3RUaW1lTGluZSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgLy9jb25zb2xlLmxvZyhcIlJFTkRFUiA9IFwiKTtcclxuICAgICAgdGhpcy5fcm9vdFRpbWVMaW5lLnVwZGF0ZShkdCk7XHJcbiAgICB9XHJcbiAgICAvL2NvbnNvbGUubG9nKFwiUkVOREVSID0gXCIpO1xyXG4gICAgLy91cGRhdGUgdmlld1xyXG4gICAgdGhpcy5fdmlldy5yZW5kZXIoKTtcclxuICB9XHJcblxyXG4gICAgcHJpdmF0ZSBvbktleURvd24oZXZlbnQpOiB2b2lkIHtcclxuICAgICAgICBpZihldmVudC5rZXlDb2RlPT0xMDkpe1xyXG4gICAgICAgICAgICB2YXIgdGVzdDpPcnRob2dyYXBoaWNQcm9qZWN0aW9uID0gPE9ydGhvZ3JhcGhpY1Byb2plY3Rpb24+IHRoaXMuX3ZpZXcuY2FtZXJhLnByb2plY3Rpb247XHJcbiAgICAgICAgICAgIHRlc3QucHJvamVjdGlvbkhlaWdodCs9NTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZihldmVudC5rZXlDb2RlPT0xMDcpe1xyXG4gICAgICAgICAgICB2YXIgdGVzdDpPcnRob2dyYXBoaWNQcm9qZWN0aW9uID0gPE9ydGhvZ3JhcGhpY1Byb2plY3Rpb24+IHRoaXMuX3ZpZXcuY2FtZXJhLnByb2plY3Rpb247XHJcbiAgICAgICAgICAgIHRlc3QucHJvamVjdGlvbkhlaWdodC09NTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gIHByaXZhdGUgb25Nb3VzZURvd24oZXZlbnQpOiB2b2lkXHJcbiAge1xyXG4gIC8qICB0aGlzLl9sYXN0UGFuQW5nbGUgPSB0aGlzLl9jYW1lcmFDb250cm9sbGVyLnBhbkFuZ2xlO1xyXG4gICAgdGhpcy5fbGFzdFRpbHRBbmdsZSA9IHRoaXMuX2NhbWVyYUNvbnRyb2xsZXIudGlsdEFuZ2xlO1xyXG4gICAgdGhpcy5fbW92ZSA9IHRydWU7Ki9cclxuICAgIHRoaXMuX2xhc3RNb3VzZVggPSBldmVudC5jbGllbnRYO1xyXG4gICAgdGhpcy5fbGFzdE1vdXNlWSA9IGV2ZW50LmNsaWVudFk7XHJcbiAgICB0aGlzLl9tb3ZlID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgb25Nb3VzZVVwKGV2ZW50KTogdm9pZFxyXG4gIHtcclxuICAgIHRoaXMuX21vdmUgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgb25Nb3VzZU1vdmUoZXZlbnQpXHJcbiAge1xyXG4gICAgaWYgKHRoaXMuX21vdmUpIHtcclxuICAgICAgICBpZiAoIGV2ZW50LmNsaWVudFg+KHRoaXMuX2xhc3RNb3VzZVgrMTApKVxyXG4gICAgICAgICAgICB0aGlzLl92aWV3LmNhbWVyYS54Kz0xMDtcclxuICAgICAgICBlbHNlIGlmICggZXZlbnQuY2xpZW50WD50aGlzLl9sYXN0TW91c2VYKVxyXG4gICAgICAgICAgICB0aGlzLl92aWV3LmNhbWVyYS54Kys7XHJcbiAgICAgICAgZWxzZSBpZiAoIGV2ZW50LmNsaWVudFg8KHRoaXMuX2xhc3RNb3VzZVgtMTApKVxyXG4gICAgICAgICAgICB0aGlzLl92aWV3LmNhbWVyYS54LT0xMDtcclxuICAgICAgICBlbHNlIGlmICggZXZlbnQuY2xpZW50WDx0aGlzLl9sYXN0TW91c2VYKVxyXG4gICAgICAgICAgICB0aGlzLl92aWV3LmNhbWVyYS54LS07XHJcbiAgICAgICAgaWYgKCBldmVudC5jbGllbnRZPih0aGlzLl9sYXN0TW91c2VZKzEwKSlcclxuICAgICAgICAgICAgdGhpcy5fdmlldy5jYW1lcmEueSs9MTA7XHJcbiAgICAgICAgZWxzZSBpZiAoIGV2ZW50LmNsaWVudFk+dGhpcy5fbGFzdE1vdXNlWSlcclxuICAgICAgICAgICAgdGhpcy5fdmlldy5jYW1lcmEueSsrO1xyXG4gICAgICAgIGVsc2UgaWYgKCBldmVudC5jbGllbnRZPCh0aGlzLl9sYXN0TW91c2VZLTEwKSlcclxuICAgICAgICAgICAgdGhpcy5fdmlldy5jYW1lcmEueS09MTA7XHJcbiAgICAgICAgZWxzZSBpZiAoIGV2ZW50LmNsaWVudFk8dGhpcy5fbGFzdE1vdXNlWSlcclxuICAgICAgICAgICAgdGhpcy5fdmlldy5jYW1lcmEueS0tO1xyXG4gICAgICAgIHRoaXMuX2xhc3RNb3VzZVggPSBldmVudC5jbGllbnRYO1xyXG4gICAgICAgIHRoaXMuX2xhc3RNb3VzZVkgPSBldmVudC5jbGllbnRZO1xyXG4gICAgICAvL3RoaXMuX2NhbWVyYUNvbnRyb2xsZXIucGFuQW5nbGUgPSAwLjMqKGV2ZW50LmNsaWVudFggLSB0aGlzLl9sYXN0TW91c2VYKSArIHRoaXMuX2xhc3RQYW5BbmdsZTtcclxuICAgICAgLy90aGlzLl9jYW1lcmFDb250cm9sbGVyLnRpbHRBbmdsZSA9IDAuMyooZXZlbnQuY2xpZW50WSAtIHRoaXMuX2xhc3RNb3VzZVkpICsgdGhpcy5fbGFzdFRpbHRBbmdsZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgb25Nb3VzZVdoZWVsKGV2ZW50KTogdm9pZFxyXG4gIHtcclxuXHJcbiAgIC8qIHRoaXMuX2NhbWVyYUNvbnRyb2xsZXIuZGlzdGFuY2UgLT0gZXZlbnQud2hlZWxEZWx0YSAqIDU7XHJcblxyXG4gICAgaWYgKHRoaXMuX2NhbWVyYUNvbnRyb2xsZXIuZGlzdGFuY2UgPCAxMDApIHtcclxuICAgICAgdGhpcy5fY2FtZXJhQ29udHJvbGxlci5kaXN0YW5jZSA9IDEwMDtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5fY2FtZXJhQ29udHJvbGxlci5kaXN0YW5jZSA+IDIwMDApIHtcclxuICAgICAgdGhpcy5fY2FtZXJhQ29udHJvbGxlci5kaXN0YW5jZSA9IDIwMDA7XHJcbiAgICB9XHJcbiAgICAqL1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBvblJlc2l6ZShldmVudCA9IG51bGwpOiB2b2lkXHJcbiAge1xyXG4gICAgdGhpcy5fdmlldy55ICAgICAgICAgPSAwO1xyXG4gICAgdGhpcy5fdmlldy54ICAgICAgICAgPSAwO1xyXG4gICAgdGhpcy5fdmlldy53aWR0aCAgICAgPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgIHRoaXMuX3ZpZXcuaGVpZ2h0ICAgID0gd2luZG93LmlubmVySGVpZ2h0O1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcblx0bmV3IEFXRDNWaWV3ZXIoKTtcclxufTtcclxuIl19