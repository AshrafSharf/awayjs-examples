/*

AWD3 file loading example in AwayJS

Demonstrates:

How to use the Loader object to load an embedded internal awd model.

Code by Rob Bateman
rob@infiniteturtles.co.uk
http://www.infiniteturtles.co.uk

This code is distributed under the MIT License

Copyright (c) The Away Foundation http://www.theawayfoundation.org

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the “Software”), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/
var AssetLibrary = require("awayjs-core/lib/library/AssetLibrary");
var AssetType = require("awayjs-core/lib/library/AssetType");
var AssetEvent = require("awayjs-core/lib/events/AssetEvent");
var URLRequest = require("awayjs-core/lib/net/URLRequest");
var LoaderEvent = require("awayjs-core/lib/events/LoaderEvent");
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var OrthographicOffCenterProjection = require("awayjs-core/lib/projections/OrthographicOffCenterProjection");
var RequestAnimationFrame = require("awayjs-core/lib/utils/RequestAnimationFrame");
var View = require("awayjs-display/lib/containers/View");
var HoverController = require("awayjs-display/lib/controllers/HoverController");
var Loader = require("awayjs-display/lib/containers/Loader");
var DefaultRenderer = require("awayjs-renderergl/lib/DefaultRenderer");
var MethodRendererPool = require("awayjs-methodmaterials/lib/pool/MethodRendererPool");
var AWDParser = require("awayjs-parsers/lib/AWDParser");
var AWD3Viewer = (function () {
    /**
     * Constructor
     */
    function AWD3Viewer() {
        this._time = 0;
        this.init();
    }
    /**
     * Global initialise function
     */
    AWD3Viewer.prototype.init = function () {
        this.initEngine();
        this.initObjects();
        this.initListeners();
    };
    /**
     * Initialise the engine
     */
    AWD3Viewer.prototype.initEngine = function () {
        //create the view
        this._view = new View(new DefaultRenderer(MethodRendererPool));
        this._view.backgroundColor = 0xffffff;
        //create custom lens
        this._view.camera.projection = new OrthographicOffCenterProjection(0, 550, -400, 0);
        this._view.camera.projection.far = 500000;
        this._view.camera.projection.near = 0.1;
        //setup controller to be used on the camera
        this._cameraController = new HoverController(this._view.camera, null, 0, 0, 300, 10, 90);
        this._cameraController.lookAtPosition = new Vector3D(0, 50, 0);
        this._cameraController.tiltAngle = 0;
        this._cameraController.panAngle = 0;
        this._cameraController.minTiltAngle = 5;
        this._cameraController.maxTiltAngle = 60;
        this._cameraController.autoUpdate = false;
    };
    /**
     * Initialise the scene objects
     */
    AWD3Viewer.prototype.initObjects = function () {
        var _this = this;
        AssetLibrary.enableParser(AWDParser);
        //kickoff asset loading
        var loader = new Loader();
        loader.addEventListener(AssetEvent.ASSET_COMPLETE, function (event) { return _this.onAssetComplete(event); });
        loader.addEventListener(LoaderEvent.RESOURCE_COMPLETE, function (event) { return _this.onRessourceComplete(event); });
        ;
        loader.load(new URLRequest("assets/AWD3/ScareCrow_old.awd"));
        // console.log("START LOADING");
        //this._view.scene.addChild(loader);
    };
    /**
     * Initialise the listeners
     */
    AWD3Viewer.prototype.initListeners = function () {
        var _this = this;
        window.onresize = function (event) { return _this.onResize(event); };
        document.onmousedown = function (event) { return _this.onMouseDown(event); };
        document.onmouseup = function (event) { return _this.onMouseUp(event); };
        document.onmousemove = function (event) { return _this.onMouseMove(event); };
        document.onmousewheel = function (event) { return _this.onMouseWheel(event); };
        this.onResize();
        this._timer = new RequestAnimationFrame(this.onEnterFrame, this);
        this._timer.start();
    };
    /**
     * loader listener for asset complete events
     */
    AWD3Viewer.prototype.onAssetComplete = function (event) {
        if (event.asset.assetType == AssetType.GEOMETRY) {
        }
        if (event.asset.assetType == AssetType.TIMELINE) {
            this._rootTimeLine = event.asset;
            this._rootTimeLine.start(); // we want to start all timelines for now...
        }
    };
    /**
     * loader listener for asset complete events
     */
    AWD3Viewer.prototype.onRessourceComplete = function (event) {
        if (this._rootTimeLine) {
            console.log("LOADING A ROOT name = " + this._rootTimeLine.name + " duration=" + this._rootTimeLine.duration);
            this._rootTimeLine.start();
            this._view.scene.addChild(this._rootTimeLine);
        }
    };
    /**
     * Render loop
     */
    AWD3Viewer.prototype.onEnterFrame = function (dt) {
        this._time += dt;
        //update camera controler
        this._cameraController.update();
        if (this._rootTimeLine != undefined) {
            //console.log("RENDER = ");
            this._rootTimeLine.update(dt);
        }
        //console.log("RENDER = ");
        //update view
        this._view.render();
    };
    AWD3Viewer.prototype.onMouseDown = function (event) {
        this._lastPanAngle = this._cameraController.panAngle;
        this._lastTiltAngle = this._cameraController.tiltAngle;
        this._lastMouseX = event.clientX;
        this._lastMouseY = event.clientY;
        this._move = true;
    };
    AWD3Viewer.prototype.onMouseUp = function (event) {
        this._move = false;
    };
    AWD3Viewer.prototype.onMouseMove = function (event) {
        if (this._move) {
            this._cameraController.panAngle = 0.3 * (event.clientX - this._lastMouseX) + this._lastPanAngle;
            this._cameraController.tiltAngle = 0.3 * (event.clientY - this._lastMouseY) + this._lastTiltAngle;
        }
    };
    AWD3Viewer.prototype.onMouseWheel = function (event) {
        this._cameraController.distance -= event.wheelDelta * 5;
        if (this._cameraController.distance < 100) {
            this._cameraController.distance = 100;
        }
        else if (this._cameraController.distance > 2000) {
            this._cameraController.distance = 2000;
        }
    };
    AWD3Viewer.prototype.onResize = function (event) {
        if (event === void 0) { event = null; }
        this._view.y = 0;
        this._view.x = 0;
        this._view.width = window.innerWidth;
        this._view.height = window.innerHeight;
    };
    return AWD3Viewer;
})();
window.onload = function () {
    new AWD3Viewer();
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9BV0QzVmlld2VyLnRzIl0sIm5hbWVzIjpbIkFXRDNWaWV3ZXIiLCJBV0QzVmlld2VyLmNvbnN0cnVjdG9yIiwiQVdEM1ZpZXdlci5pbml0IiwiQVdEM1ZpZXdlci5pbml0RW5naW5lIiwiQVdEM1ZpZXdlci5pbml0T2JqZWN0cyIsIkFXRDNWaWV3ZXIuaW5pdExpc3RlbmVycyIsIkFXRDNWaWV3ZXIub25Bc3NldENvbXBsZXRlIiwiQVdEM1ZpZXdlci5vblJlc3NvdXJjZUNvbXBsZXRlIiwiQVdEM1ZpZXdlci5vbkVudGVyRnJhbWUiLCJBV0QzVmlld2VyLm9uTW91c2VEb3duIiwiQVdEM1ZpZXdlci5vbk1vdXNlVXAiLCJBV0QzVmlld2VyLm9uTW91c2VNb3ZlIiwiQVdEM1ZpZXdlci5vbk1vdXNlV2hlZWwiLCJBV0QzVmlld2VyLm9uUmVzaXplIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztFQWtDRTtBQUVGLElBQU8sWUFBWSxXQUFlLHNDQUFzQyxDQUFDLENBQUM7QUFDMUUsSUFBTyxTQUFTLFdBQWUsbUNBQW1DLENBQUMsQ0FBQztBQUNwRSxJQUFPLFVBQVUsV0FBZSxtQ0FBbUMsQ0FBQyxDQUFDO0FBQ3JFLElBQU8sVUFBVSxXQUFlLGdDQUFnQyxDQUFDLENBQUM7QUFDbEUsSUFBTyxXQUFXLFdBQWUsb0NBQW9DLENBQUMsQ0FBQztBQUN2RSxJQUFPLFFBQVEsV0FBZ0IsK0JBQStCLENBQUMsQ0FBQztBQUNoRSxJQUFPLCtCQUErQixXQUFZLDZEQUE2RCxDQUFDLENBQUM7QUFFakgsSUFBTyxxQkFBcUIsV0FBWSw2Q0FBNkMsQ0FBQyxDQUFDO0FBRXZGLElBQU8sSUFBSSxXQUFpQixvQ0FBb0MsQ0FBQyxDQUFDO0FBSWxFLElBQU8sZUFBZSxXQUFjLGdEQUFnRCxDQUFDLENBQUM7QUFDdEYsSUFBTyxNQUFNLFdBQWdCLHNDQUFzQyxDQUFDLENBQUM7QUFLckUsSUFBTyxlQUFlLFdBQWMsdUNBQXVDLENBQUMsQ0FBQztBQUc3RSxJQUFPLGtCQUFrQixXQUFhLG9EQUFvRCxDQUFDLENBQUM7QUFFNUYsSUFBTyxTQUFTLFdBQWUsOEJBQThCLENBQUMsQ0FBQztBQUUvRCxJQUFNLFVBQVU7SUFrQmRBOztPQUVHQTtJQUNIQSxTQXJCSUEsVUFBVUE7UUFTTkMsVUFBS0EsR0FBV0EsQ0FBQ0EsQ0FBQ0E7UUFjeEJBLElBQUlBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBO0lBQ2RBLENBQUNBO0lBRUREOztPQUVHQTtJQUNLQSx5QkFBSUEsR0FBWkE7UUFFRUUsSUFBSUEsQ0FBQ0EsVUFBVUEsRUFBRUEsQ0FBQ0E7UUFDbEJBLElBQUlBLENBQUNBLFdBQVdBLEVBQUVBLENBQUNBO1FBQ25CQSxJQUFJQSxDQUFDQSxhQUFhQSxFQUFFQSxDQUFDQTtJQUN2QkEsQ0FBQ0E7SUFFREY7O09BRUdBO0lBQ0tBLCtCQUFVQSxHQUFsQkE7UUFFRUcsQUFDQUEsaUJBRGlCQTtRQUNqQkEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsSUFBSUEsQ0FBQ0EsSUFBSUEsZUFBZUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMvREEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsZUFBZUEsR0FBR0EsUUFBUUEsQ0FBQ0E7UUFFdENBLEFBQ0FBLG9CQURvQkE7UUFDcEJBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLFVBQVVBLEdBQUdBLElBQUlBLCtCQUErQkEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDcEZBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLFVBQVVBLENBQUNBLEdBQUdBLEdBQUdBLE1BQU1BLENBQUNBO1FBQzFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxVQUFVQSxDQUFDQSxJQUFJQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUV4Q0EsQUFDQUEsMkNBRDJDQTtRQUMzQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxHQUFHQSxJQUFJQSxlQUFlQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxFQUFFQSxJQUFJQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUN6RkEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxjQUFjQSxHQUFHQSxJQUFJQSxRQUFRQSxDQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMvREEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxTQUFTQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNyQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxRQUFRQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNwQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxZQUFZQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUN4Q0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxZQUFZQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUN6Q0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxVQUFVQSxHQUFHQSxLQUFLQSxDQUFDQTtJQUM1Q0EsQ0FBQ0E7SUFFREg7O09BRUdBO0lBQ0tBLGdDQUFXQSxHQUFuQkE7UUFBQUksaUJBc0JDQTtRQXBCQ0EsWUFBWUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0E7UUFFckNBLEFBQ0FBLHVCQUR1QkE7WUFDbkJBLE1BQU1BLEdBQVVBLElBQUlBLE1BQU1BLEVBQUVBLENBQUNBO1FBQ2pDQSxNQUFNQSxDQUFDQSxnQkFBZ0JBLENBQUNBLFVBQVVBLENBQUNBLGNBQWNBLEVBQUVBLFVBQUNBLEtBQWlCQSxJQUFLQSxPQUFBQSxLQUFJQSxDQUFDQSxlQUFlQSxDQUFDQSxLQUFLQSxDQUFDQSxFQUEzQkEsQ0FBMkJBLENBQUNBLENBQUNBO1FBQ3ZHQSxNQUFNQSxDQUFDQSxnQkFBZ0JBLENBQUNBLFdBQVdBLENBQUNBLGlCQUFpQkEsRUFBRUEsVUFBQ0EsS0FBa0JBLElBQUtBLE9BQUFBLEtBQUlBLENBQUNBLG1CQUFtQkEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsRUFBL0JBLENBQStCQSxDQUFDQSxDQUFDQTtRQVcxRUEsQ0FBQ0E7UUFDdkNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLFVBQVVBLENBQUNBLCtCQUErQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDN0RBLGdDQUFnQ0E7UUFDaENBLG9DQUFvQ0E7SUFDdENBLENBQUNBO0lBRURKOztPQUVHQTtJQUNLQSxrQ0FBYUEsR0FBckJBO1FBQUFLLGlCQWFDQTtRQVhDQSxNQUFNQSxDQUFDQSxRQUFRQSxHQUFJQSxVQUFDQSxLQUFLQSxJQUFLQSxPQUFBQSxLQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxLQUFLQSxDQUFDQSxFQUFwQkEsQ0FBb0JBLENBQUNBO1FBRW5EQSxRQUFRQSxDQUFDQSxXQUFXQSxHQUFHQSxVQUFDQSxLQUFLQSxJQUFLQSxPQUFBQSxLQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxLQUFLQSxDQUFDQSxFQUF2QkEsQ0FBdUJBLENBQUNBO1FBQzFEQSxRQUFRQSxDQUFDQSxTQUFTQSxHQUFHQSxVQUFDQSxLQUFLQSxJQUFLQSxPQUFBQSxLQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxLQUFLQSxDQUFDQSxFQUFyQkEsQ0FBcUJBLENBQUNBO1FBQ3REQSxRQUFRQSxDQUFDQSxXQUFXQSxHQUFHQSxVQUFDQSxLQUFLQSxJQUFLQSxPQUFBQSxLQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxLQUFLQSxDQUFDQSxFQUF2QkEsQ0FBdUJBLENBQUNBO1FBQzFEQSxRQUFRQSxDQUFDQSxZQUFZQSxHQUFHQSxVQUFDQSxLQUFLQSxJQUFLQSxPQUFBQSxLQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxLQUFLQSxDQUFDQSxFQUF4QkEsQ0FBd0JBLENBQUNBO1FBRTVEQSxJQUFJQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQTtRQUVoQkEsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsSUFBSUEscUJBQXFCQSxDQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUNqRUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0E7SUFDdEJBLENBQUNBO0lBRURMOztPQUVHQTtJQUNLQSxvQ0FBZUEsR0FBdkJBLFVBQXdCQSxLQUFpQkE7UUFFdkNNLEVBQUVBLENBQUFBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLFNBQVNBLElBQUlBLFNBQVNBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBO1FBVWpEQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFBQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxTQUFTQSxJQUFJQSxTQUFTQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMvQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBY0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0E7WUFDNUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLEtBQUtBLEVBQUVBLEVBQUVBLDRDQUE0Q0E7UUFJMUVBLENBQUNBLEdBSjRCQTtJQUsvQkEsQ0FBQ0E7SUFFRE47O09BRUdBO0lBQ0tBLHdDQUFtQkEsR0FBM0JBLFVBQTRCQSxLQUFrQkE7UUFDNUNPLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLENBQUNBO1lBQ3ZCQSxPQUFPQSxDQUFDQSxHQUFHQSxDQUFDQSx3QkFBd0JBLEdBQUdBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLElBQUlBLEdBQUdBLFlBQVlBLEdBQUdBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO1lBQzdHQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQTtZQUMzQkEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0E7UUFDaERBLENBQUNBO0lBQ0hBLENBQUNBO0lBRURQOztPQUVHQTtJQUNLQSxpQ0FBWUEsR0FBcEJBLFVBQXFCQSxFQUFVQTtRQUM3QlEsSUFBSUEsQ0FBQ0EsS0FBS0EsSUFBSUEsRUFBRUEsQ0FBQ0E7UUFFakJBLEFBQ0FBLHlCQUR5QkE7UUFDekJBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7UUFDaENBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLElBQUlBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3BDQSxBQUNBQSwyQkFEMkJBO1lBQzNCQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxNQUFNQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUNoQ0EsQ0FBQ0E7UUFDREEsQUFFQUEsMkJBRjJCQTtRQUMzQkEsYUFBYUE7UUFDYkEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7SUFDdEJBLENBQUNBO0lBRU9SLGdDQUFXQSxHQUFuQkEsVUFBb0JBLEtBQUtBO1FBRXZCUyxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLFFBQVFBLENBQUNBO1FBQ3JEQSxJQUFJQSxDQUFDQSxjQUFjQSxHQUFHQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLFNBQVNBLENBQUNBO1FBQ3ZEQSxJQUFJQSxDQUFDQSxXQUFXQSxHQUFHQSxLQUFLQSxDQUFDQSxPQUFPQSxDQUFDQTtRQUNqQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsR0FBR0EsS0FBS0EsQ0FBQ0EsT0FBT0EsQ0FBQ0E7UUFDakNBLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO0lBQ3BCQSxDQUFDQTtJQUVPVCw4QkFBU0EsR0FBakJBLFVBQWtCQSxLQUFLQTtRQUVyQlUsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsS0FBS0EsQ0FBQ0E7SUFDckJBLENBQUNBO0lBRU9WLGdDQUFXQSxHQUFuQkEsVUFBb0JBLEtBQUtBO1FBRXZCVyxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNmQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLFFBQVFBLEdBQUdBLEdBQUdBLEdBQUNBLENBQUNBLEtBQUtBLENBQUNBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBO1lBQzlGQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLFNBQVNBLEdBQUdBLEdBQUdBLEdBQUNBLENBQUNBLEtBQUtBLENBQUNBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBO1FBQ2xHQSxDQUFDQTtJQUNIQSxDQUFDQTtJQUVPWCxpQ0FBWUEsR0FBcEJBLFVBQXFCQSxLQUFLQTtRQUV4QlksSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxRQUFRQSxJQUFJQSxLQUFLQSxDQUFDQSxVQUFVQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUV4REEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxRQUFRQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMxQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxRQUFRQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUN4Q0EsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNsREEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUN6Q0EsQ0FBQ0E7SUFDSEEsQ0FBQ0E7SUFFT1osNkJBQVFBLEdBQWhCQSxVQUFpQkEsS0FBWUE7UUFBWmEscUJBQVlBLEdBQVpBLFlBQVlBO1FBRTNCQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxHQUFXQSxDQUFDQSxDQUFDQTtRQUN6QkEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsR0FBV0EsQ0FBQ0EsQ0FBQ0E7UUFDekJBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEdBQU9BLE1BQU1BLENBQUNBLFVBQVVBLENBQUNBO1FBQ3pDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFNQSxNQUFNQSxDQUFDQSxXQUFXQSxDQUFDQTtJQUM1Q0EsQ0FBQ0E7SUFFSGIsaUJBQUNBO0FBQURBLENBeE1BLEFBd01DQSxJQUFBO0FBRUQsTUFBTSxDQUFDLE1BQU0sR0FBRztJQUNmLElBQUksVUFBVSxFQUFFLENBQUM7QUFDbEIsQ0FBQyxDQUFDIiwiZmlsZSI6IkFXRDNWaWV3ZXIuanMiLCJzb3VyY2VSb290IjoiLi8iLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG5cclxuQVdEMyBmaWxlIGxvYWRpbmcgZXhhbXBsZSBpbiBBd2F5SlNcclxuXHJcbkRlbW9uc3RyYXRlczpcclxuXHJcbkhvdyB0byB1c2UgdGhlIExvYWRlciBvYmplY3QgdG8gbG9hZCBhbiBlbWJlZGRlZCBpbnRlcm5hbCBhd2QgbW9kZWwuXHJcblxyXG5Db2RlIGJ5IFJvYiBCYXRlbWFuXHJcbnJvYkBpbmZpbml0ZXR1cnRsZXMuY28udWtcclxuaHR0cDovL3d3dy5pbmZpbml0ZXR1cnRsZXMuY28udWtcclxuXHJcblRoaXMgY29kZSBpcyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2VcclxuXHJcbkNvcHlyaWdodCAoYykgVGhlIEF3YXkgRm91bmRhdGlvbiBodHRwOi8vd3d3LnRoZWF3YXlmb3VuZGF0aW9uLm9yZ1xyXG5cclxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxyXG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSDigJxTb2Z0d2FyZeKAnSksIHRvIGRlYWxcclxuaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xyXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXHJcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xyXG5mdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxyXG5cclxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cclxuYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXHJcblxyXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQg4oCcQVMgSVPigJ0sIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcclxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXHJcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxyXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXHJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXHJcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cclxuVEhFIFNPRlRXQVJFLlxyXG5cclxuKi9cclxuXHJcbmltcG9ydCBBc3NldExpYnJhcnlcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2xpYnJhcnkvQXNzZXRMaWJyYXJ5XCIpO1xyXG5pbXBvcnQgQXNzZXRUeXBlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9saWJyYXJ5L0Fzc2V0VHlwZVwiKTtcclxuaW1wb3J0IEFzc2V0RXZlbnRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2V2ZW50cy9Bc3NldEV2ZW50XCIpO1xyXG5pbXBvcnQgVVJMUmVxdWVzdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTFJlcXVlc3RcIik7XHJcbmltcG9ydCBMb2FkZXJFdmVudFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0xvYWRlckV2ZW50XCIpO1xyXG5pbXBvcnQgVmVjdG9yM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcclxuaW1wb3J0IE9ydGhvZ3JhcGhpY09mZkNlbnRlclByb2plY3Rpb25cdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3Byb2plY3Rpb25zL09ydGhvZ3JhcGhpY09mZkNlbnRlclByb2plY3Rpb25cIik7XHJcbmltcG9ydCBLZXlib2FyZFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi91aS9LZXlib2FyZFwiKTtcclxuaW1wb3J0IFJlcXVlc3RBbmltYXRpb25GcmFtZVx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdXRpbHMvUmVxdWVzdEFuaW1hdGlvbkZyYW1lXCIpO1xyXG5cclxuaW1wb3J0IFZpZXdcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9jb250YWluZXJzL1ZpZXdcIik7XHJcbmltcG9ydCBNZXNoXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvTWVzaFwiKTtcclxuaW1wb3J0IENvbnRhaW5lclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvY29udGFpbmVycy9EaXNwbGF5T2JqZWN0Q29udGFpbmVyXCIpO1xyXG5pbXBvcnQgR2VvbWV0cnlcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9HZW9tZXRyeVwiKTtcclxuaW1wb3J0IEhvdmVyQ29udHJvbGxlclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2NvbnRyb2xsZXJzL0hvdmVyQ29udHJvbGxlclwiKTtcclxuaW1wb3J0IExvYWRlclx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9jb250YWluZXJzL0xvYWRlclwiKTtcclxuaW1wb3J0IFRpbWVMaW5lXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL1RpbWVMaW5lXCIpO1xyXG5pbXBvcnQgQ29sb3JNYXRlcmlhbFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9CYXNpY01hdGVyaWFsXCIpO1xyXG5pbXBvcnQgUHJpbWl0aXZlQ3ViZVByZWZhYlx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9wcmVmYWJzL1ByaW1pdGl2ZUN1YmVQcmVmYWJcIik7XHJcblxyXG5pbXBvcnQgRGVmYXVsdFJlbmRlcmVyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvRGVmYXVsdFJlbmRlcmVyXCIpO1xyXG5cclxuaW1wb3J0IE1ldGhvZE1hdGVyaWFsXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtbWV0aG9kbWF0ZXJpYWxzL2xpYi9NZXRob2RNYXRlcmlhbFwiKTtcclxuaW1wb3J0IE1ldGhvZFJlbmRlcmVyUG9vbFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1tZXRob2RtYXRlcmlhbHMvbGliL3Bvb2wvTWV0aG9kUmVuZGVyZXJQb29sXCIpO1xyXG5cclxuaW1wb3J0IEFXRFBhcnNlclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcGFyc2Vycy9saWIvQVdEUGFyc2VyXCIpO1xyXG5cclxuY2xhc3MgQVdEM1ZpZXdlclxyXG57XHJcbiAgLy9lbmdpbmUgdmFyaWFibGVzXHJcbiAgcHJpdmF0ZSBfdmlldzogVmlldztcclxuICBwcml2YXRlIF9jYW1lcmFDb250cm9sbGVyOiBIb3ZlckNvbnRyb2xsZXI7XHJcblxyXG4gIHByaXZhdGUgX3Jvb3RUaW1lTGluZTogVGltZUxpbmU7XHJcblxyXG4gIHByaXZhdGUgX3RpbWVyOiBSZXF1ZXN0QW5pbWF0aW9uRnJhbWU7XHJcbiAgcHJpdmF0ZSBfdGltZTogbnVtYmVyID0gMDtcclxuXHJcbiAgLy9uYXZpZ2F0aW9uXHJcbiAgcHJpdmF0ZSBfbGFzdFBhbkFuZ2xlOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBfbGFzdFRpbHRBbmdsZTogbnVtYmVyO1xyXG4gIHByaXZhdGUgX2xhc3RNb3VzZVg6IG51bWJlcjtcclxuICBwcml2YXRlIF9sYXN0TW91c2VZOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBfbW92ZTogYm9vbGVhbjtcclxuXHJcbiAgLyoqXHJcbiAgICogQ29uc3RydWN0b3JcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcigpXHJcbiAge1xyXG4gICAgdGhpcy5pbml0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHbG9iYWwgaW5pdGlhbGlzZSBmdW5jdGlvblxyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5pdCgpOiB2b2lkXHJcbiAge1xyXG4gICAgdGhpcy5pbml0RW5naW5lKCk7XHJcbiAgICB0aGlzLmluaXRPYmplY3RzKCk7XHJcbiAgICB0aGlzLmluaXRMaXN0ZW5lcnMoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEluaXRpYWxpc2UgdGhlIGVuZ2luZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5pdEVuZ2luZSgpOiB2b2lkXHJcbiAge1xyXG4gICAgLy9jcmVhdGUgdGhlIHZpZXdcclxuICAgIHRoaXMuX3ZpZXcgPSBuZXcgVmlldyhuZXcgRGVmYXVsdFJlbmRlcmVyKE1ldGhvZFJlbmRlcmVyUG9vbCkpO1xyXG4gICAgdGhpcy5fdmlldy5iYWNrZ3JvdW5kQ29sb3IgPSAweGZmZmZmZjtcclxuXHJcbiAgICAvL2NyZWF0ZSBjdXN0b20gbGVuc1xyXG4gICAgdGhpcy5fdmlldy5jYW1lcmEucHJvamVjdGlvbiA9IG5ldyBPcnRob2dyYXBoaWNPZmZDZW50ZXJQcm9qZWN0aW9uKDAsIDU1MCwgLTQwMCwgMCk7XHJcbiAgICB0aGlzLl92aWV3LmNhbWVyYS5wcm9qZWN0aW9uLmZhciA9IDUwMDAwMDtcclxuICAgIHRoaXMuX3ZpZXcuY2FtZXJhLnByb2plY3Rpb24ubmVhciA9IDAuMTtcclxuXHJcbiAgICAvL3NldHVwIGNvbnRyb2xsZXIgdG8gYmUgdXNlZCBvbiB0aGUgY2FtZXJhXHJcbiAgICB0aGlzLl9jYW1lcmFDb250cm9sbGVyID0gbmV3IEhvdmVyQ29udHJvbGxlcih0aGlzLl92aWV3LmNhbWVyYSwgbnVsbCwgMCwgMCwgMzAwLCAxMCwgOTApO1xyXG4gICAgdGhpcy5fY2FtZXJhQ29udHJvbGxlci5sb29rQXRQb3NpdGlvbiA9IG5ldyBWZWN0b3IzRCgwLCA1MCwgMCk7XHJcbiAgICB0aGlzLl9jYW1lcmFDb250cm9sbGVyLnRpbHRBbmdsZSA9IDA7XHJcbiAgICB0aGlzLl9jYW1lcmFDb250cm9sbGVyLnBhbkFuZ2xlID0gMDtcclxuICAgIHRoaXMuX2NhbWVyYUNvbnRyb2xsZXIubWluVGlsdEFuZ2xlID0gNTtcclxuICAgIHRoaXMuX2NhbWVyYUNvbnRyb2xsZXIubWF4VGlsdEFuZ2xlID0gNjA7XHJcbiAgICB0aGlzLl9jYW1lcmFDb250cm9sbGVyLmF1dG9VcGRhdGUgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEluaXRpYWxpc2UgdGhlIHNjZW5lIG9iamVjdHNcclxuICAgKi9cclxuICBwcml2YXRlIGluaXRPYmplY3RzKCk6IHZvaWRcclxuICB7XHJcbiAgICBBc3NldExpYnJhcnkuZW5hYmxlUGFyc2VyKEFXRFBhcnNlcik7XHJcblxyXG4gICAgLy9raWNrb2ZmIGFzc2V0IGxvYWRpbmdcclxuICAgIHZhciBsb2FkZXI6TG9hZGVyID0gbmV3IExvYWRlcigpO1xyXG4gICAgbG9hZGVyLmFkZEV2ZW50TGlzdGVuZXIoQXNzZXRFdmVudC5BU1NFVF9DT01QTEVURSwgKGV2ZW50OiBBc3NldEV2ZW50KSA9PiB0aGlzLm9uQXNzZXRDb21wbGV0ZShldmVudCkpO1xyXG4gICAgbG9hZGVyLmFkZEV2ZW50TGlzdGVuZXIoTG9hZGVyRXZlbnQuUkVTT1VSQ0VfQ09NUExFVEUsIChldmVudDogTG9hZGVyRXZlbnQpID0+IHRoaXMub25SZXNzb3VyY2VDb21wbGV0ZShldmVudCkpO1xyXG5cclxuICAgIC8qXHJcbiAgICB2YXIgX2N1YmU6UHJpbWl0aXZlQ3ViZVByZWZhYiA9IG5ldyBQcmltaXRpdmVDdWJlUHJlZmFiKDIwLjAsIDIwLjAsIDIwLjApO1xyXG4gICAgdmFyIG5ld21lc2gyOk1lc2g9PCBNZXNoPl9jdWJlLmdldE5ld09iamVjdCgpO1xyXG4gICAgLy8gbmV3bWVzaDIubWF0ZXJpYWw9bmV3IENvbG9yTWF0ZXJpYWwoMHhmZjAwMDAsIDEuMCk7XHJcbiAgICAvL25ld21lc2gyLm1hdGVyaWFsLmJvdGhTaWRlcz10cnVlO1xyXG4gICAgdmFyIG1hdFR4Ok1ldGhvZE1hdGVyaWFsID0gbmV3IE1ldGhvZE1hdGVyaWFsICgweEZGMDAwMCk7XHJcbiAgICBtYXRUeC5ib3RoU2lkZXMgPSB0cnVlO1xyXG4gICAgbmV3bWVzaDIubWF0ZXJpYWw9bWF0VHg7XHJcbiAgICB0aGlzLl92aWV3LnNjZW5lLmFkZENoaWxkKG5ld21lc2gyKTtcclxuICAgIGNvbnNvbGUubG9nKFwiTE9BREVUIEEgR2VvbSBuYW1lID0gXCIpKi87XHJcbiAgICBsb2FkZXIubG9hZChuZXcgVVJMUmVxdWVzdChcImFzc2V0cy9BV0QzL1NjYXJlQ3Jvd19vbGQuYXdkXCIpKTtcclxuICAgIC8vIGNvbnNvbGUubG9nKFwiU1RBUlQgTE9BRElOR1wiKTtcclxuICAgIC8vdGhpcy5fdmlldy5zY2VuZS5hZGRDaGlsZChsb2FkZXIpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSW5pdGlhbGlzZSB0aGUgbGlzdGVuZXJzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbml0TGlzdGVuZXJzKCk6IHZvaWRcclxuICB7XHJcbiAgICB3aW5kb3cub25yZXNpemUgID0gKGV2ZW50KSA9PiB0aGlzLm9uUmVzaXplKGV2ZW50KTtcclxuXHJcbiAgICBkb2N1bWVudC5vbm1vdXNlZG93biA9IChldmVudCkgPT4gdGhpcy5vbk1vdXNlRG93bihldmVudCk7XHJcbiAgICBkb2N1bWVudC5vbm1vdXNldXAgPSAoZXZlbnQpID0+IHRoaXMub25Nb3VzZVVwKGV2ZW50KTtcclxuICAgIGRvY3VtZW50Lm9ubW91c2Vtb3ZlID0gKGV2ZW50KSA9PiB0aGlzLm9uTW91c2VNb3ZlKGV2ZW50KTtcclxuICAgIGRvY3VtZW50Lm9ubW91c2V3aGVlbCA9IChldmVudCkgPT4gdGhpcy5vbk1vdXNlV2hlZWwoZXZlbnQpO1xyXG5cclxuICAgIHRoaXMub25SZXNpemUoKTtcclxuXHJcbiAgICB0aGlzLl90aW1lciA9IG5ldyBSZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5vbkVudGVyRnJhbWUsIHRoaXMpO1xyXG4gICAgdGhpcy5fdGltZXIuc3RhcnQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGxvYWRlciBsaXN0ZW5lciBmb3IgYXNzZXQgY29tcGxldGUgZXZlbnRzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBvbkFzc2V0Q29tcGxldGUoZXZlbnQ6IEFzc2V0RXZlbnQpOiB2b2lkXHJcbiAge1xyXG4gICAgaWYoZXZlbnQuYXNzZXQuYXNzZXRUeXBlID09IEFzc2V0VHlwZS5HRU9NRVRSWSkge1xyXG4gICAgICAvL3ZhciBuZXdtZXNoOk1lc2g9bmV3IE1lc2goPEdlb21ldHJ5PmV2ZW50LmFzc2V0KTtcclxuICAgICAgLy92YXIgbWF0VHg6TWV0aG9kTWF0ZXJpYWwgPSBuZXcgTWV0aG9kTWF0ZXJpYWwgKDB4RkYwMDAwKTtcclxuICAgICAgLy9tYXRUeC5ib3RoU2lkZXM9dHJ1ZTtcclxuICAgICAgLy9uZXdtZXNoLm1hdGVyaWFsPW1hdFR4O1xyXG4gICAgICAvLy8gdGhpcy5fdmlldy5zY2VuZS5hZGRDaGlsZChuZXdtZXNoKTtcclxuICAgICAgLy92YXIgX2N1YmU6UHJpbWl0aXZlQ3ViZVByZWZhYiA9IG5ldyBQcmltaXRpdmVDdWJlUHJlZmFiKDIwLjAsIDIwLjAsIDIwLjApO1xyXG4gICAgICAvL3ZhciBuZXdtZXNoMjpNZXNoPTwgTWVzaD5fY3ViZS5nZXROZXdPYmplY3QoKTtcclxuICAgICAgLy90aGlzLl92aWV3LnNjZW5lLmFkZENoaWxkKG5ld21lc2gyKTtcclxuICAgICAgLy9jb25zb2xlLmxvZyhcIkxPQURFVCBBIEdlb20gbmFtZSA9IFwiKTtcclxuICAgIH1cclxuXHJcbiAgICBpZihldmVudC5hc3NldC5hc3NldFR5cGUgPT0gQXNzZXRUeXBlLlRJTUVMSU5FKSB7XHJcbiAgICAgIHRoaXMuX3Jvb3RUaW1lTGluZSA9IDxUaW1lTGluZT4gZXZlbnQuYXNzZXQ7XHJcbiAgICAgIHRoaXMuX3Jvb3RUaW1lTGluZS5zdGFydCgpOyAvLyB3ZSB3YW50IHRvIHN0YXJ0IGFsbCB0aW1lbGluZXMgZm9yIG5vdy4uLlxyXG4gICAgICAvL3RoaXMuX3Jvb3RUaW1lTGluZS5nb3RvQW5kU3RvcCgwKTtcclxuICAgICAgLy90aGlzLl92aWV3LnNjZW5lLmFkZENoaWxkKHRoaXMuX3Jvb3RUaW1lTGluZSk7XHJcbiAgICAgIC8vY29uc29sZS5sb2coXCJMT0FERVQgQSBUaW1lTGluZSBuYW1lID0gXCIgKyB0aGlzLl9yb290VGltZUxpbmUubmFtZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBsb2FkZXIgbGlzdGVuZXIgZm9yIGFzc2V0IGNvbXBsZXRlIGV2ZW50c1xyXG4gICAqL1xyXG4gIHByaXZhdGUgb25SZXNzb3VyY2VDb21wbGV0ZShldmVudDogTG9hZGVyRXZlbnQpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLl9yb290VGltZUxpbmUpIHtcclxuICAgICAgY29uc29sZS5sb2coXCJMT0FESU5HIEEgUk9PVCBuYW1lID0gXCIgKyB0aGlzLl9yb290VGltZUxpbmUubmFtZSArIFwiIGR1cmF0aW9uPVwiICsgdGhpcy5fcm9vdFRpbWVMaW5lLmR1cmF0aW9uKTtcclxuICAgICAgdGhpcy5fcm9vdFRpbWVMaW5lLnN0YXJ0KCk7XHJcbiAgICAgIHRoaXMuX3ZpZXcuc2NlbmUuYWRkQ2hpbGQodGhpcy5fcm9vdFRpbWVMaW5lKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbmRlciBsb29wXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBvbkVudGVyRnJhbWUoZHQ6IG51bWJlcik6IHZvaWQge1xyXG4gICAgdGhpcy5fdGltZSArPSBkdDtcclxuXHJcbiAgICAvL3VwZGF0ZSBjYW1lcmEgY29udHJvbGVyXHJcbiAgICB0aGlzLl9jYW1lcmFDb250cm9sbGVyLnVwZGF0ZSgpO1xyXG4gICAgaWYgKHRoaXMuX3Jvb3RUaW1lTGluZSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgLy9jb25zb2xlLmxvZyhcIlJFTkRFUiA9IFwiKTtcclxuICAgICAgdGhpcy5fcm9vdFRpbWVMaW5lLnVwZGF0ZShkdCk7XHJcbiAgICB9XHJcbiAgICAvL2NvbnNvbGUubG9nKFwiUkVOREVSID0gXCIpO1xyXG4gICAgLy91cGRhdGUgdmlld1xyXG4gICAgdGhpcy5fdmlldy5yZW5kZXIoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgb25Nb3VzZURvd24oZXZlbnQpOiB2b2lkXHJcbiAge1xyXG4gICAgdGhpcy5fbGFzdFBhbkFuZ2xlID0gdGhpcy5fY2FtZXJhQ29udHJvbGxlci5wYW5BbmdsZTtcclxuICAgIHRoaXMuX2xhc3RUaWx0QW5nbGUgPSB0aGlzLl9jYW1lcmFDb250cm9sbGVyLnRpbHRBbmdsZTtcclxuICAgIHRoaXMuX2xhc3RNb3VzZVggPSBldmVudC5jbGllbnRYO1xyXG4gICAgdGhpcy5fbGFzdE1vdXNlWSA9IGV2ZW50LmNsaWVudFk7XHJcbiAgICB0aGlzLl9tb3ZlID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgb25Nb3VzZVVwKGV2ZW50KTogdm9pZFxyXG4gIHtcclxuICAgIHRoaXMuX21vdmUgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgb25Nb3VzZU1vdmUoZXZlbnQpXHJcbiAge1xyXG4gICAgaWYgKHRoaXMuX21vdmUpIHtcclxuICAgICAgdGhpcy5fY2FtZXJhQ29udHJvbGxlci5wYW5BbmdsZSA9IDAuMyooZXZlbnQuY2xpZW50WCAtIHRoaXMuX2xhc3RNb3VzZVgpICsgdGhpcy5fbGFzdFBhbkFuZ2xlO1xyXG4gICAgICB0aGlzLl9jYW1lcmFDb250cm9sbGVyLnRpbHRBbmdsZSA9IDAuMyooZXZlbnQuY2xpZW50WSAtIHRoaXMuX2xhc3RNb3VzZVkpICsgdGhpcy5fbGFzdFRpbHRBbmdsZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgb25Nb3VzZVdoZWVsKGV2ZW50KTogdm9pZFxyXG4gIHtcclxuICAgIHRoaXMuX2NhbWVyYUNvbnRyb2xsZXIuZGlzdGFuY2UgLT0gZXZlbnQud2hlZWxEZWx0YSAqIDU7XHJcblxyXG4gICAgaWYgKHRoaXMuX2NhbWVyYUNvbnRyb2xsZXIuZGlzdGFuY2UgPCAxMDApIHtcclxuICAgICAgdGhpcy5fY2FtZXJhQ29udHJvbGxlci5kaXN0YW5jZSA9IDEwMDtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5fY2FtZXJhQ29udHJvbGxlci5kaXN0YW5jZSA+IDIwMDApIHtcclxuICAgICAgdGhpcy5fY2FtZXJhQ29udHJvbGxlci5kaXN0YW5jZSA9IDIwMDA7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9uUmVzaXplKGV2ZW50ID0gbnVsbCk6IHZvaWRcclxuICB7XHJcbiAgICB0aGlzLl92aWV3LnkgICAgICAgICA9IDA7XHJcbiAgICB0aGlzLl92aWV3LnggICAgICAgICA9IDA7XHJcbiAgICB0aGlzLl92aWV3LndpZHRoICAgICA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgdGhpcy5fdmlldy5oZWlnaHQgICAgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbiAgfVxyXG5cclxufVxyXG5cclxud2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuXHRuZXcgQVdEM1ZpZXdlcigpO1xyXG59O1xyXG4iXX0=