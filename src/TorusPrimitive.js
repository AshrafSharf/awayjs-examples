var View = require("awayjs-core/lib/containers/View");
var DirectionalLight = require("awayjs-core/lib/entities/DirectionalLight");
var AwayEvent = require("awayjs-core/lib/events/Event");
var URLLoader = require("awayjs-core/lib/core/net/URLLoader");
var URLLoaderDataFormat = require("awayjs-core/lib/core/net/URLLoaderDataFormat");
var URLRequest = require("awayjs-core/lib/core/net/URLRequest");
var TriangleMethodMaterial = require("awayjs-stagegl/lib/materials/TriangleMethodMaterial");
var ParserUtils = require("awayjs-core/lib/parsers/ParserUtils");
var PrimitiveTorusPrefab = require("awayjs-core/lib/prefabs/PrimitiveTorusPrefab");
var StaticLightPicker = require("awayjs-core/lib/materials/lightpickers/StaticLightPicker");
var DefaultRenderer = require("awayjs-stagegl/lib/core/render/DefaultRenderer");
var ImageTexture = require("awayjs-core/lib/textures/ImageTexture");
var RequestAnimationFrame = require("awayjs-core/lib/utils/RequestAnimationFrame");
var TorusPrimitive = (function () {
    function TorusPrimitive() {
        var _this = this;
        this.initView();
        this._raf = new RequestAnimationFrame(this.render, this);
        this._raf.start(); // Start the frame loop ( request animation frame )
        this.loadResources(); // Start loading the resources
        window.onresize = function (event) { return _this.resize(event); }; // Add event handler for window resize
        this.resize();
    }
    /**
     *
     */
    TorusPrimitive.prototype.initView = function () {
        this._view = new View(new DefaultRenderer()); // Create the Away3D View
        this._view.backgroundColor = 0x000000; // Change the background color to black
    };
    /**
     *
     */
    TorusPrimitive.prototype.loadResources = function () {
        var _this = this;
        var urlRequest = new URLRequest("assets/dots.png");
        var imgLoader = new URLLoader(); // Image Loader
        imgLoader.dataFormat = URLLoaderDataFormat.BLOB;
        imgLoader.addEventListener(AwayEvent.COMPLETE, function (event) { return _this.urlCompleteHandler(event); }); // Add event listener for image complete
        imgLoader.load(urlRequest); // start loading
    };
    /**
     *
     * @param event
     */
    TorusPrimitive.prototype.urlCompleteHandler = function (event) {
        var _this = this;
        var imageLoader = event.target;
        this._image = ParserUtils.blobToImage(imageLoader.data);
        this._image.onload = function (event) { return _this.imageCompleteHandler(event); };
    };
    /**
     *
     */
    TorusPrimitive.prototype.initLights = function () {
        this._light = new DirectionalLight(); // Create a directional light
        this._light.diffuse = .7;
        this._light.specular = 1;
        this._view.scene.addChild(this._light);
        this._lightPicker = new StaticLightPicker([this._light]); // Create a light picker
    };
    /**
     *
     */
    TorusPrimitive.prototype.initMaterial = function (image) {
        this._texture = new ImageTexture(image, false); // Create a texture
        this._material = new TriangleMethodMaterial(this._texture, true, true, false); // Create a material
        this._material.lightPicker = this._lightPicker; // assign the lights to the material
    };
    /**
     *
     */
    TorusPrimitive.prototype.initTorus = function () {
        this._torus = new PrimitiveTorusPrefab(220, 80, 32, 16, false); // Create the Torus prefab
        this._mesh = this._torus.getNewObject(); //Create the mesh
        this._mesh.material = this._material; //apply the material
        this._view.scene.addChild(this._mesh); // Add the mesh to the scene
    };
    /**
     *
     */
    TorusPrimitive.prototype.imageCompleteHandler = function (event) {
        this.initLights();
        this.initMaterial(event.target);
        this.initTorus();
    };
    /**
     *
     */
    TorusPrimitive.prototype.render = function (dt) {
        if (dt === void 0) { dt = null; }
        if (this._mesh)
            this._mesh.rotationY += 1;
        this._view.render();
    };
    /**
     *
     */
    TorusPrimitive.prototype.resize = function (event) {
        if (event === void 0) { event = null; }
        this._view.y = 0;
        this._view.x = 0;
        this._view.width = window.innerWidth;
        this._view.height = window.innerHeight;
    };
    return TorusPrimitive;
})();
window.onload = function () {
    new TorusPrimitive(); // Start the demo
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9Ub3J1c1ByaW1pdGl2ZS50cyJdLCJuYW1lcyI6WyJUb3J1c1ByaW1pdGl2ZSIsIlRvcnVzUHJpbWl0aXZlLmNvbnN0cnVjdG9yIiwiVG9ydXNQcmltaXRpdmUuaW5pdFZpZXciLCJUb3J1c1ByaW1pdGl2ZS5sb2FkUmVzb3VyY2VzIiwiVG9ydXNQcmltaXRpdmUudXJsQ29tcGxldGVIYW5kbGVyIiwiVG9ydXNQcmltaXRpdmUuaW5pdExpZ2h0cyIsIlRvcnVzUHJpbWl0aXZlLmluaXRNYXRlcmlhbCIsIlRvcnVzUHJpbWl0aXZlLmluaXRUb3J1cyIsIlRvcnVzUHJpbWl0aXZlLmltYWdlQ29tcGxldGVIYW5kbGVyIiwiVG9ydXNQcmltaXRpdmUucmVuZGVyIiwiVG9ydXNQcmltaXRpdmUucmVzaXplIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFPLElBQUksV0FBaUIsaUNBQWlDLENBQUMsQ0FBQztBQUMvRCxJQUFPLGdCQUFnQixXQUFjLDJDQUEyQyxDQUFDLENBQUM7QUFHbEYsSUFBTyxTQUFTLFdBQWUsOEJBQThCLENBQUMsQ0FBQztBQUkvRCxJQUFPLFNBQVMsV0FBZSxvQ0FBb0MsQ0FBQyxDQUFDO0FBQ3JFLElBQU8sbUJBQW1CLFdBQWEsOENBQThDLENBQUMsQ0FBQztBQUN2RixJQUFPLFVBQVUsV0FBZSxxQ0FBcUMsQ0FBQyxDQUFDO0FBQ3ZFLElBQU8sc0JBQXNCLFdBQVkscURBQXFELENBQUMsQ0FBQztBQUNoRyxJQUFPLFdBQVcsV0FBZSxxQ0FBcUMsQ0FBQyxDQUFDO0FBQ3hFLElBQU8sb0JBQW9CLFdBQWEsOENBQThDLENBQUMsQ0FBQztBQUV4RixJQUFPLGlCQUFpQixXQUFhLDBEQUEwRCxDQUFDLENBQUM7QUFDakcsSUFBTyxlQUFlLFdBQWMsZ0RBQWdELENBQUMsQ0FBQztBQUN0RixJQUFPLFlBQVksV0FBZSx1Q0FBdUMsQ0FBQyxDQUFDO0FBQzNFLElBQU8scUJBQXFCLFdBQVksNkNBQTZDLENBQUMsQ0FBQztBQUV2RixJQUFNLGNB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QUFDQTtRQUNuQkEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBb0JBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQ25EQSxJQUFJQSxDQUFDQSxTQUFTQSxFQUFHQSxDQUFDQTtJQUNuQkEsQ0FBQ0E7SUFFRFI7O09BRUdBO0lBQ0lBLCtCQUFNQSxHQUFiQSxVQUFjQSxFQUFnQkE7UUFBaEJTLGtCQUFnQkEsR0FBaEJBLFNBQWdCQTtRQUU3QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7WUFDZEEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsU0FBU0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFFM0JBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUdBLENBQUNBO0lBQ3RCQSxDQUFDQTtJQUVEVDs7T0FFR0E7SUFDSUEsK0JBQU1BLEdBQWJBLFVBQWNBLEtBQW9CQTtRQUFwQlUscUJBQW9CQSxHQUFwQkEsWUFBb0JBO1FBRWpDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNqQkEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDakJBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEdBQUdBLE1BQU1BLENBQUNBLFVBQVVBLENBQUNBO1FBQ3JDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxNQUFNQSxDQUFDQSxXQUFXQSxDQUFDQTtJQUN4Q0EsQ0FBQ0E7SUFDRlYscUJBQUNBO0FBQURBLENBMUhBLEFBMEhDQSxJQUFBO0FBRUQsTUFBTSxDQUFDLE1BQU0sR0FBRztJQUVmLElBQUksY0FBYyxFQUFFLEVBQUUsaUJBQWlCO0FBQ3hDLENBQUMsQ0FBQSxFQURxQiIsImZpbGUiOiJUb3J1c1ByaW1pdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIuLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBWaWV3XHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29udGFpbmVycy9WaWV3XCIpO1xuaW1wb3J0IERpcmVjdGlvbmFsTGlnaHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9lbnRpdGllcy9EaXJlY3Rpb25hbExpZ2h0XCIpO1xuaW1wb3J0IE1lc2hcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9lbnRpdGllcy9NZXNoXCIpO1xuaW1wb3J0IFNreWJveFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9lbnRpdGllcy9Ta3lib3hcIik7XG5pbXBvcnQgQXdheUV2ZW50XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvRXZlbnRcIik7XG5pbXBvcnQgTG9hZGVyRXZlbnRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2V2ZW50cy9Mb2FkZXJFdmVudFwiKTtcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL2dlb20vVmVjdG9yM0RcIik7XG5pbXBvcnQgQXNzZXRMaWJyYXJ5XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL2xpYnJhcnkvQXNzZXRMaWJyYXJ5XCIpO1xuaW1wb3J0IFVSTExvYWRlclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9uZXQvVVJMTG9hZGVyXCIpO1xuaW1wb3J0IFVSTExvYWRlckRhdGFGb3JtYXRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9uZXQvVVJMTG9hZGVyRGF0YUZvcm1hdFwiKTtcbmltcG9ydCBVUkxSZXF1ZXN0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL25ldC9VUkxSZXF1ZXN0XCIpO1xuaW1wb3J0IFRyaWFuZ2xlTWV0aG9kTWF0ZXJpYWxcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL21hdGVyaWFscy9UcmlhbmdsZU1ldGhvZE1hdGVyaWFsXCIpO1xuaW1wb3J0IFBhcnNlclV0aWxzXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wYXJzZXJzL1BhcnNlclV0aWxzXCIpO1xuaW1wb3J0IFByaW1pdGl2ZVRvcnVzUHJlZmFiXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3ByZWZhYnMvUHJpbWl0aXZlVG9ydXNQcmVmYWJcIik7XG5pbXBvcnQgUGVyc3BlY3RpdmVQcm9qZWN0aW9uXHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9wcm9qZWN0aW9ucy9QZXJzcGVjdGl2ZVByb2plY3Rpb25cIik7XG5pbXBvcnQgU3RhdGljTGlnaHRQaWNrZXJcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbWF0ZXJpYWxzL2xpZ2h0cGlja2Vycy9TdGF0aWNMaWdodFBpY2tlclwiKTtcbmltcG9ydCBEZWZhdWx0UmVuZGVyZXJcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9jb3JlL3JlbmRlci9EZWZhdWx0UmVuZGVyZXJcIik7XG5pbXBvcnQgSW1hZ2VUZXh0dXJlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9JbWFnZVRleHR1cmVcIik7XG5pbXBvcnQgUmVxdWVzdEFuaW1hdGlvbkZyYW1lXHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi91dGlscy9SZXF1ZXN0QW5pbWF0aW9uRnJhbWVcIik7XG5cbmNsYXNzIFRvcnVzUHJpbWl0aXZlXG57XG5cdHByaXZhdGUgX3ZpZXc6Vmlldztcblx0cHJpdmF0ZSBfdG9ydXM6UHJpbWl0aXZlVG9ydXNQcmVmYWI7XG5cdHByaXZhdGUgX21lc2g6TWVzaDtcblx0cHJpdmF0ZSBfcmFmOlJlcXVlc3RBbmltYXRpb25GcmFtZTtcblx0cHJpdmF0ZSBfaW1hZ2U6SFRNTEltYWdlRWxlbWVudDtcblx0cHJpdmF0ZSBfdGV4dHVyZTpJbWFnZVRleHR1cmU7XG5cdHByaXZhdGUgX21hdGVyaWFsOlRyaWFuZ2xlTWV0aG9kTWF0ZXJpYWw7XG5cdHByaXZhdGUgX2xpZ2h0OkRpcmVjdGlvbmFsTGlnaHQ7XG5cdHByaXZhdGUgX2xpZ2h0UGlja2VyOlN0YXRpY0xpZ2h0UGlja2VyO1xuXG5cdGNvbnN0cnVjdG9yICgpXG5cdHtcblx0XHR0aGlzLmluaXRWaWV3KCk7XG5cblx0XHR0aGlzLl9yYWYgPSBuZXcgUmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMucmVuZGVyLCB0aGlzKTtcblx0XHR0aGlzLl9yYWYuc3RhcnQoKTsgLy8gU3RhcnQgdGhlIGZyYW1lIGxvb3AgKCByZXF1ZXN0IGFuaW1hdGlvbiBmcmFtZSApXG5cblx0XHR0aGlzLmxvYWRSZXNvdXJjZXMoKTsgLy8gU3RhcnQgbG9hZGluZyB0aGUgcmVzb3VyY2VzXG5cdFx0d2luZG93Lm9ucmVzaXplID0gKGV2ZW50OlVJRXZlbnQpID0+IHRoaXMucmVzaXplKGV2ZW50KTsgLy8gQWRkIGV2ZW50IGhhbmRsZXIgZm9yIHdpbmRvdyByZXNpemVcblxuXHRcdHRoaXMucmVzaXplKCk7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICovXG5cdHByaXZhdGUgaW5pdFZpZXcoKVxuXHR7XG5cdFx0dGhpcy5fdmlldyA9IG5ldyBWaWV3KG5ldyBEZWZhdWx0UmVuZGVyZXIoKSk7Ly8gQ3JlYXRlIHRoZSBBd2F5M0QgVmlld1xuXHRcdHRoaXMuX3ZpZXcuYmFja2dyb3VuZENvbG9yID0gMHgwMDAwMDA7Ly8gQ2hhbmdlIHRoZSBiYWNrZ3JvdW5kIGNvbG9yIHRvIGJsYWNrXG5cdH1cblxuXHQvKipcblx0ICpcblx0ICovXG5cdHByaXZhdGUgbG9hZFJlc291cmNlcygpXG5cdHtcblx0XHR2YXIgdXJsUmVxdWVzdDpVUkxSZXF1ZXN0ID0gbmV3IFVSTFJlcXVlc3QgKFwiYXNzZXRzL2RvdHMucG5nXCIpO1xuXHRcdHZhciBpbWdMb2FkZXI6VVJMTG9hZGVyID0gbmV3IFVSTExvYWRlcigpOyAvLyBJbWFnZSBMb2FkZXJcblx0XHRpbWdMb2FkZXIuZGF0YUZvcm1hdCA9IFVSTExvYWRlckRhdGFGb3JtYXQuQkxPQjtcblxuXHRcdGltZ0xvYWRlci5hZGRFdmVudExpc3RlbmVyIChBd2F5RXZlbnQuQ09NUExFVEUsIChldmVudDpBd2F5RXZlbnQpID0+IHRoaXMudXJsQ29tcGxldGVIYW5kbGVyKGV2ZW50KSk7IC8vIEFkZCBldmVudCBsaXN0ZW5lciBmb3IgaW1hZ2UgY29tcGxldGVcblx0XHRpbWdMb2FkZXIubG9hZCh1cmxSZXF1ZXN0KTsgLy8gc3RhcnQgbG9hZGluZ1xuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqIEBwYXJhbSBldmVudFxuXHQgKi9cblx0cHJpdmF0ZSB1cmxDb21wbGV0ZUhhbmRsZXIgKGV2ZW50OkF3YXlFdmVudClcblx0e1xuXHRcdHZhciBpbWFnZUxvYWRlcjpVUkxMb2FkZXIgPSA8VVJMTG9hZGVyPiBldmVudC50YXJnZXRcblx0XHR0aGlzLl9pbWFnZSA9IFBhcnNlclV0aWxzLmJsb2JUb0ltYWdlKGltYWdlTG9hZGVyLmRhdGEpO1xuXHRcdHRoaXMuX2ltYWdlLm9ubG9hZCA9IChldmVudDpFdmVudCkgPT4gdGhpcy5pbWFnZUNvbXBsZXRlSGFuZGxlcihldmVudCk7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICovXG5cdHByaXZhdGUgaW5pdExpZ2h0cygpXG5cdHtcblx0XHR0aGlzLl9saWdodCA9IG5ldyBEaXJlY3Rpb25hbExpZ2h0KCk7IC8vIENyZWF0ZSBhIGRpcmVjdGlvbmFsIGxpZ2h0XG5cdFx0dGhpcy5fbGlnaHQuZGlmZnVzZSA9IC43O1xuXHRcdHRoaXMuX2xpZ2h0LnNwZWN1bGFyID0gMTtcblx0XHR0aGlzLl92aWV3LnNjZW5lLmFkZENoaWxkKHRoaXMuX2xpZ2h0KTtcblx0XHR0aGlzLl9saWdodFBpY2tlciA9IG5ldyBTdGF0aWNMaWdodFBpY2tlcihbdGhpcy5fbGlnaHRdKTsgLy8gQ3JlYXRlIGEgbGlnaHQgcGlja2VyXG5cdH1cblxuXHQvKipcblx0ICpcblx0ICovXG5cdHByaXZhdGUgaW5pdE1hdGVyaWFsKGltYWdlOkhUTUxJbWFnZUVsZW1lbnQpXG5cdHtcblx0XHR0aGlzLl90ZXh0dXJlID0gbmV3IEltYWdlVGV4dHVyZShpbWFnZSwgZmFsc2UpOyAvLyBDcmVhdGUgYSB0ZXh0dXJlXG5cdFx0dGhpcy5fbWF0ZXJpYWwgPSBuZXcgVHJpYW5nbGVNZXRob2RNYXRlcmlhbCAodGhpcy5fdGV4dHVyZSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpOyAvLyBDcmVhdGUgYSBtYXRlcmlhbFxuXHRcdHRoaXMuX21hdGVyaWFsLmxpZ2h0UGlja2VyID0gdGhpcy5fbGlnaHRQaWNrZXI7IC8vIGFzc2lnbiB0aGUgbGlnaHRzIHRvIHRoZSBtYXRlcmlhbFxuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRwcml2YXRlIGluaXRUb3J1cygpXG5cdHtcblx0XHR0aGlzLl90b3J1cyA9IG5ldyBQcmltaXRpdmVUb3J1c1ByZWZhYigyMjAsIDgwLCAzMiwgMTYsIGZhbHNlKTsgLy8gQ3JlYXRlIHRoZSBUb3J1cyBwcmVmYWJcblx0XHR0aGlzLl9tZXNoID0gPE1lc2g+IHRoaXMuX3RvcnVzLmdldE5ld09iamVjdCgpOyAvL0NyZWF0ZSB0aGUgbWVzaFxuXHRcdHRoaXMuX21lc2gubWF0ZXJpYWwgPSB0aGlzLl9tYXRlcmlhbDsgLy9hcHBseSB0aGUgbWF0ZXJpYWxcblx0XHR0aGlzLl92aWV3LnNjZW5lLmFkZENoaWxkKHRoaXMuX21lc2gpOyAvLyBBZGQgdGhlIG1lc2ggdG8gdGhlIHNjZW5lXG5cdH1cblxuXHQvKipcblx0ICpcblx0ICovXG5cdHByaXZhdGUgaW1hZ2VDb21wbGV0ZUhhbmRsZXIoZXZlbnQ6RXZlbnQpXG5cdHtcblx0XHR0aGlzLmluaXRMaWdodHMgKCk7XG5cdFx0dGhpcy5pbml0TWF0ZXJpYWwoPEhUTUxJbWFnZUVsZW1lbnQ+IGV2ZW50LnRhcmdldCk7XG5cdFx0dGhpcy5pbml0VG9ydXMgKCk7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICovXG5cdHB1YmxpYyByZW5kZXIoZHQ6bnVtYmVyID0gbnVsbClcblx0e1xuXHRcdGlmICh0aGlzLl9tZXNoKVxuXHRcdFx0dGhpcy5fbWVzaC5yb3RhdGlvblkgKz0gMTtcblxuXHRcdHRoaXMuX3ZpZXcucmVuZGVyICgpO1xuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRwdWJsaWMgcmVzaXplKGV2ZW50OlVJRXZlbnQgPSBudWxsKVxuXHR7XG5cdFx0dGhpcy5fdmlldy55ID0gMDtcblx0XHR0aGlzLl92aWV3LnggPSAwO1xuXHRcdHRoaXMuX3ZpZXcud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcblx0XHR0aGlzLl92aWV3LmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcblx0fVxufVxuXG53aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKVxue1xuXHRuZXcgVG9ydXNQcmltaXRpdmUoKTsgLy8gU3RhcnQgdGhlIGRlbW9cbn0iXX0=