(function e(s,r,t){function i(n,o){if(!r[n]){if(!s[n]){var u=typeof require=="function"&&require;if(!o&&u)return u(n,!0);if(a)return a(n,!0);var h=new Error("Cannot find module '"+n+"'");throw h.code="MODULE_NOT_FOUND",h}var l=r[n]={exports:{}};s[n][0].call(l.exports,function(e){var r=s[n][1][e];return i(r?r:e)},l,l.exports,e,s,r,t)}return r[n].exports}var a=typeof require=="function"&&require;for(var n=0;n<t.length;n++)i(t[n]);return i})({"./src/CurveDemo.ts":[function(e,s,r){var t=e("awayjs-core/lib/attributes/AttributesBuffer");var i=e("awayjs-core/lib/events/Event");var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-core/lib/geom/ColorTransform");var o=e("awayjs-core/lib/net/URLLoader");var u=e("awayjs-core/lib/net/URLLoaderDataFormat");var h=e("awayjs-core/lib/net/URLRequest");var l=e("awayjs-core/lib/parsers/ParserUtils");var p=e("awayjs-core/lib/utils/RequestAnimationFrame");var d=e("awayjs-display/lib/base/CurveSubGeometry");var v=e("awayjs-display/lib/base/Geometry");var c=e("awayjs-display/lib/containers/View");var w=e("awayjs-display/lib/controllers/HoverController");var f=e("awayjs-display/lib/entities/DirectionalLight");var m=e("awayjs-display/lib/entities/Mesh");var y=e("awayjs-display/lib/materials/BasicMaterial");var _=e("awayjs-display/lib/textures/Single2DTexture");var b=e("awayjs-renderergl/lib/DefaultRenderer");var g=e("awayjs-methodmaterials/lib/MethodMaterial");var j=function(){function e(){var e=this;this.initView();this._raf=new p(this.render,this);this._raf.start();this.loadResources();window.onresize=function(s){return e.onResize(s)};this.onResize()}e.prototype.initView=function(){var e=this;this._view=new c(new b);this._view.backgroundColor=2245734;this._cameraController=new w(this._view.camera,null,0,0,-150,10,90);this._cameraController.lookAtPosition=new a(0,0,0);this._cameraController.tiltAngle=0;this._cameraController.panAngle=0;this._cameraController.minTiltAngle=-60;this._cameraController.maxTiltAngle=60;this._cameraController.autoUpdate=false;document.onmousedown=function(s){return e.onMouseDown(s)};document.onmouseup=function(s){return e.onMouseUp(s)};document.onmousemove=function(s){return e.onMouseMove(s)};document.onmousewheel=function(s){return e.onMouseWheel(s)}};e.prototype.onMouseDown=function(e){this._lastPanAngle=this._cameraController.panAngle;this._lastTiltAngle=this._cameraController.tiltAngle;this._lastMouseX=e.clientX;this._lastMouseY=e.clientY;this._move=true};e.prototype.onMouseUp=function(e){this._move=false};e.prototype.onMouseMove=function(e){if(this._move){this._cameraController.panAngle=.3*(e.clientX-this._lastMouseX)+this._lastPanAngle;this._cameraController.tiltAngle=.3*(e.clientY-this._lastMouseY)+this._lastTiltAngle}var s=this._view.unproject(this._view.mouseX,this._view.mouseY,0);var r=this._view.unproject(this._view.mouseX,this._view.mouseY,1).subtract(s);var t=new a(0,0,-1,0);var i=new a;var n=t.x*s.x+t.y*s.y+t.z*s.z+t.w;i.x=s.x-t.x*n;i.y=s.y-t.y*n;i.z=s.z-t.z*n;var o=new a(t.x,t.y,t.z);var u=-s.dotProduct(o)/r.dotProduct(o);r.scaleBy(u);var h=s.add(r);console.log(h);for(var l=0;l<this._view.scene.numChildren;l++){var p=this._view.scene.getChildAt(l);var d=p;if(d){var v=false;for(var c=0;c<d.geometry.subGeometries.length;c++){var w=d.geometry.subGeometries[c];v=this.hittestMesh(h.x,h.y,w);if(v)break}console.log("HIT::",v);if(v){var f=d.colorTransform;f.alphaMultiplier=.2;d.colorTransform=f}else{var f=d.colorTransform;f.alphaMultiplier=1;d.colorTransform=f}}}};e.prototype.hittestMesh=function(e,s,r){var t=r.positions.dimensions;var i=r.curves.dimensions;var a=r.indices.get(r.indices.count);var n=r.positions.get(r.positions.count);var o=r.curves.get(r.curves.count);for(var u=0;u<r.indices.length;u+=3){var h=a[u];var l=a[u+1]*t;var p=a[u+2]*t;var d=n[h*t];var v=n[h*t+1];var c=n[l];var w=n[l+1];var f=n[p];var m=n[p+1];var y=o[h*i];var _=n[h*t+2];var b=d-e;var g=v-s;var j=w-v;var C=-(c-d);var M=b*j+g*C;if(M>0)continue;b=c-e;g=w-s;j=m-w;C=-(f-c);M=b*j+g*C;if(M>0)continue;b=f-e;g=m-s;j=v-m;C=-(d-f);M=b*j+g*C;if(M>0)continue;if(y!=2){var T=c-d;var A=w-v;var x=f-d;var D=m-v;var L=e-d;var R=s-v;var U=T*D-x*A;var P=(L*D-x*R)/U;var z=(T*R-L*A)/U;var B=1-P-z;var V=.5*P+z;var q=z;var G=V*V-q;if(G>0&&_==-1){continue}else if(G<0&&_==1){continue}}return true}return false};e.prototype.onMouseWheel=function(e){this._cameraController.distance-=e.wheelDelta*2;if(this._cameraController.distance<100)this._cameraController.distance=100;else if(this._cameraController.distance>2e3)this._cameraController.distance=2e3};e.prototype.loadResources=function(){var e=this;var s=new o;s.dataFormat=u.BLOB;s.addEventListener(i.COMPLETE,function(s){return e.urlCompleteHandler(s)});s.load(new h("assets/dots_alpha.png"))};e.prototype.urlCompleteHandler=function(e){var s=this;this._image=l.blobToImage(e.target.data);this._image.onload=function(e){return s.imageCompleteHandler(e)}};e.prototype.initLights=function(){this._light=new f;this._light.diffuse=.7;this._light.specular=1};e.prototype.initMaterial=function(e){this._texture=new _(l.imageToBitmapImage2D(e));this._material=new g(this._texture,true,true,false);this._material.lightPicker=this._lightPicker};e.prototype.initTorus=function(){this.addSolidTris();this.addTexturedTris();this._view.camera.z+=750};e.prototype.addSolidTris=function(){var e=new Array;e.push(-300,-50,1);e.push(-200,50,1);e.push(-100,-50,1);e.push(-100,-50,-1);e.push(0,50,-1);e.push(100,-50,-1);e.push(100,-50,1);e.push(200,50,1);e.push(300,-50,1);e.push(-100,20,-1);e.push(-150,40,-1);e.push(-100,60,-1);e.push(100,20,1);e.push(50,40,1);e.push(100,60,1);e.push(0,0+50,1);e.push(50,0+50,1);e.push(0,-50+50,1);e.push(0,0+50,1);e.push(0,-50+50,1);e.push(-50,0+50,1);e.push(0,0+50,1);e.push(-50,0+50,1);e.push(0,50+50,1);e.push(0,0+50,1);e.push(0,50+50,1);e.push(50,0+50,1);e.push(0,0+150,1);e.push(50,0+150,1);e.push(0,-50+150,1);e.push(0,0+150,1);e.push(0,-50+150,1);e.push(-50,0+150,1);e.push(0,0+150,1);e.push(-50,0+150,1);e.push(0,50+150,1);e.push(0,0+150,1);e.push(0,50+150,1);e.push(50,0+150,1);var s=new Array;s.push(0,1,2);s.push(3,4,5);s.push(6,7,8);s.push(9,10,11);s.push(12,13,14);s.push(15,16,17);s.push(18,19,20);s.push(21,22,23);s.push(24,25,26);s.push(27,28,29);s.push(30,31,32);s.push(33,34,35);s.push(36,37,38);var r=new Array;r.push(2,1);r.push(2,0);r.push(2,0);r.push(0,0);r.push(.5,0);r.push(1,1);r.push(0,0);r.push(.5,0);r.push(1,1);r.push(0,0);r.push(.5,0);r.push(1,1);r.push(0,0);r.push(.5,0);r.push(1,1);r.push(2,1);r.push(2,0);r.push(2,0);r.push(2,1);r.push(2,0);r.push(2,0);r.push(2,1);r.push(2,0);r.push(2,0);r.push(2,1);r.push(2,0);r.push(2,0);r.push(2,1);r.push(3,1);r.push(4,1);r.push(2,1);r.push(3,1);r.push(4,1);r.push(2,1);r.push(3,1);r.push(4,1);r.push(2,1);r.push(3,1);r.push(4,1);var i=new d(new t);i.autoDeriveUVs=false;i.setPositions(e);i.setIndices(s);i.setCurves(r);var a=new v;a.addSubGeometry(i);var o=new m(a);o.colorTransform=new n(1,1,1,1,0,0,0,0);var u=new y(16777215,.5);u.preserveAlpha=true;u.alphaBlending=true;u.useColorTransform=true;o.material=u;this._view.scene.addChild(o)};e.prototype.addTexturedTris=function(){var e=new Array;e.push(-300,-50-100,1);e.push(-200,50-100,1);e.push(-100,-50-100,1);e.push(-100,-50-100,-1);e.push(0,50-100,-1);e.push(100,-50-100,-1);e.push(100,-50-100,1);e.push(200,50-100,1);e.push(300,-50-100,1);var s=new Array;s.push(0,1,2);s.push(3,4,5);s.push(6,7,8);var r=new Array;r.push(2,1);r.push(3,1);r.push(4,1);r.push(0,0);r.push(.5,0);r.push(1,1);r.push(0,0);r.push(.5,0);r.push(1,1);var i=new Array;i.push(0,0);i.push(.5,1);i.push(1,0);i.push(0,0);i.push(.5,1);i.push(1,0);i.push(0,0);i.push(.5,1);i.push(1,0);var a=new d(new t);a.autoDeriveUVs=false;a.setPositions(e);a.setIndices(s);a.setCurves(r);a.setUVs(i);var o=new v;o.addSubGeometry(a);var u=new m(o);var h=new y(this._texture);h.preserveAlpha=true;h.alphaBlending=true;u.colorTransform=new n(1,1,1,1,0,0,0,0);u.material=h;h.useColorTransform=true;this._view.scene.addChild(u)};e.prototype.imageCompleteHandler=function(e){this.initLights();this.initMaterial(e.target);this.initTorus()};e.prototype.render=function(e){if(e===void 0){e=null}if(this._mesh)this._mesh.rotationY+=1;this._view.render()};e.prototype.onResize=function(e){if(e===void 0){e=null}this._view.y=0;this._view.x=0;this._view.width=window.innerWidth;this._view.height=window.innerHeight};return e}();window.onload=function(){new j}},{"awayjs-core/lib/attributes/AttributesBuffer":undefined,"awayjs-core/lib/events/Event":undefined,"awayjs-core/lib/geom/ColorTransform":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-core/lib/net/URLLoader":undefined,"awayjs-core/lib/net/URLLoaderDataFormat":undefined,"awayjs-core/lib/net/URLRequest":undefined,"awayjs-core/lib/parsers/ParserUtils":undefined,"awayjs-core/lib/utils/RequestAnimationFrame":undefined,"awayjs-display/lib/base/CurveSubGeometry":undefined,"awayjs-display/lib/base/Geometry":undefined,"awayjs-display/lib/containers/View":undefined,"awayjs-display/lib/controllers/HoverController":undefined,"awayjs-display/lib/entities/DirectionalLight":undefined,"awayjs-display/lib/entities/Mesh":undefined,"awayjs-display/lib/materials/BasicMaterial":undefined,"awayjs-display/lib/textures/Single2DTexture":undefined,"awayjs-methodmaterials/lib/MethodMaterial":undefined,"awayjs-renderergl/lib/DefaultRenderer":undefined}]},{},["./src/CurveDemo.ts"]);

//# sourceMappingURL=CurveDemo.js.map