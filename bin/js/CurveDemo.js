(function e(s,r,i){function t(n,o){if(!r[n]){if(!s[n]){var u=typeof require=="function"&&require;if(!o&&u)return u(n,!0);if(a)return a(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}var h=r[n]={exports:{}};s[n][0].call(h.exports,function(e){var r=s[n][1][e];return t(r?r:e)},h,h.exports,e,s,r,i)}return r[n].exports}var a=typeof require=="function"&&require;for(var n=0;n<i.length;n++)t(i[n]);return t})({"./src/CurveDemo.ts":[function(e,s,r){var i=e("awayjs-core/lib/attributes/AttributesBuffer");var t=e("awayjs-core/lib/events/Event");var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-core/lib/geom/ColorTransform");var o=e("awayjs-core/lib/net/URLLoader");var u=e("awayjs-core/lib/net/URLLoaderDataFormat");var l=e("awayjs-core/lib/net/URLRequest");var h=e("awayjs-core/lib/parsers/ParserUtils");var p=e("awayjs-core/lib/utils/RequestAnimationFrame");var d=e("awayjs-display/lib/base/CurveSubGeometry");var c=e("awayjs-display/lib/base/Geometry");var v=e("awayjs-display/lib/containers/View");var w=e("awayjs-display/lib/containers/DisplayObjectContainer");var y=e("awayjs-display/lib/controllers/HoverController");var f=e("awayjs-display/lib/entities/DirectionalLight");var m=e("awayjs-display/lib/entities/Mesh");var _=e("awayjs-display/lib/materials/BasicMaterial");var b=e("awayjs-display/lib/textures/Single2DTexture");var g=e("awayjs-display/lib/pick/JSPickingCollider");var j=e("awayjs-display/lib/pick/RaycastPicker");var C=e("awayjs-display/lib/events/MouseEvent");var M=e("awayjs-renderergl/lib/DefaultRenderer");var T=e("awayjs-methodmaterials/lib/MethodMaterial");var A=function(){function e(){var e=this;this._raycastPicker=new j(false);this._container=new w;this.initView();this._view.scene.addChild(this._container);this._raf=new p(this.render,this);this._raf.start();this.loadResources();window.onresize=function(s){return e.onResize(s)};this.onResize();this._raycastPicker.onlyMouseEnabled=false}e.prototype.initView=function(){var e=this;this._view=new v(new M);this._view.backgroundColor=2245734;this._view.mousePicker=new j(true);this._cameraController=new y(this._view.camera,null,0,0,-150,10,90);this._cameraController.lookAtPosition=new a(0,0,0);this._cameraController.tiltAngle=0;this._cameraController.panAngle=0;this._cameraController.minTiltAngle=-60;this._cameraController.maxTiltAngle=60;this._cameraController.autoUpdate=false;document.onmousedown=function(s){return e.onMouseDown(s)};document.onmouseup=function(s){return e.onMouseUp(s)};document.onmousemove=function(s){return e.onMouseMove(s)};document.onmousewheel=function(s){return e.onMouseWheel(s)}};e.prototype.onMouseDown=function(e){this._lastPanAngle=this._cameraController.panAngle;this._lastTiltAngle=this._cameraController.tiltAngle;this._lastMouseX=e.clientX;this._lastMouseY=e.clientY;this._move=true};e.prototype.onMouseUp=function(e){this._move=false};e.prototype.onMouseMove=function(e){if(this._move){this._cameraController.panAngle=.3*(e.clientX-this._lastMouseX)+this._lastPanAngle;this._cameraController.tiltAngle=.3*(e.clientY-this._lastMouseY)+this._lastTiltAngle}var s=this._view.unproject(this._view.mouseX,this._view.mouseY,0);var r=this._view.unproject(this._view.mouseX,this._view.mouseY,1).subtract(s);var i=new a(0,0,-1,0);var t=new a;var n=i.x*s.x+i.y*s.y+i.z*s.z+i.w;t.x=s.x-i.x*n;t.y=s.y-i.y*n;t.z=s.z-i.z*n;var o=new a(i.x,i.y,i.z);var u=-s.dotProduct(o)/r.dotProduct(o);r.scaleBy(u);var l=s.add(r);var h=this._container.hitTestPoint(l.x,l.y,true);console.log("hit container",h);return;console.log(l);for(var p=0;p<this._view.scene.numChildren;p++){var d=this._view.scene.getChildAt(p);var c=d.hitTestPoint(l.x,l.y,true);console.log("hitChild",c);var v=d;if(v){if(v.pickingCollider){}var w=false;for(var y=0;y<v.geometry.subGeometries.length;y++){var f=v.geometry.subGeometries[y];w=this.hittestMesh(l.x,l.y,f);if(w)break}console.log("HIT::",w);if(w){var m=v.colorTransform;m.alphaMultiplier=.2;v.colorTransform=m}else{var m=v.colorTransform;m.alphaMultiplier=1;v.colorTransform=m}}}var _=this._raycastPicker.getSceneCollision(this._view.camera.transform.position,this._view.camera.transform.forwardVector,this._view.scene);if(_){console.log("picking worked",_.index)}};e.prototype.hittestMesh=function(e,s,r){var i=r.positions.dimensions;var t=r.curves.dimensions;var a=r.indices.get(r.indices.count);var n=r.positions.get(r.positions.count);var o=r.curves.get(r.curves.count);for(var u=0;u<r.indices.length;u+=3){var l=a[u];var h=a[u+1]*i;var p=a[u+2]*i;var d=n[l*i];var c=n[l*i+1];var v=n[h];var w=n[h+1];var y=n[p];var f=n[p+1];var m=o[l*t];var _=n[l*i+2];var b=d-e;var g=c-s;var j=w-c;var C=-(v-d);var M=b*j+g*C;if(M>0)continue;b=v-e;g=w-s;j=f-w;C=-(y-v);M=b*j+g*C;if(M>0)continue;b=y-e;g=f-s;j=c-f;C=-(d-y);M=b*j+g*C;if(M>0)continue;if(m!=2){var T=v-d;var A=w-c;var x=y-d;var P=f-c;var D=e-d;var k=s-c;var R=T*P-x*A;var L=(D*P-x*k)/R;var U=(T*k-D*A)/R;var E=1-L-U;var S=.5*L+U;var O=U;var V=S*S-O;if(V>0&&_==-1){continue}else if(V<0&&_==1){continue}}return true}return false};e.prototype.onMouseWheel=function(e){this._cameraController.distance-=e.wheelDelta*2;if(this._cameraController.distance<100)this._cameraController.distance=100;else if(this._cameraController.distance>2e3)this._cameraController.distance=2e3};e.prototype.loadResources=function(){var e=this;var s=new o;s.dataFormat=u.BLOB;s.addEventListener(t.COMPLETE,function(s){return e.urlCompleteHandler(s)});s.load(new l("assets/dots_alpha.png"))};e.prototype.urlCompleteHandler=function(e){var s=this;this._image=h.blobToImage(e.target.data);this._image.onload=function(e){return s.imageCompleteHandler(e)}};e.prototype.initLights=function(){this._light=new f;this._light.diffuse=.7;this._light.specular=1};e.prototype.initMaterial=function(e){this._texture=new b(h.imageToBitmapImage2D(e));this._material=new T(this._texture,true,true,false);this._material.lightPicker=this._lightPicker};e.prototype.initTorus=function(){this.addSolidTris();this.addTexturedTris();this._view.camera.z+=750};e.prototype.addSolidTris=function(){var e=new Array;e.push(-300,-50,1);e.push(-200,50,1);e.push(-100,-50,1);e.push(-100,-50,-1);e.push(0,50,-1);e.push(100,-50,-1);e.push(100,-50,1);e.push(200,50,1);e.push(300,-50,1);e.push(-100,20,-1);e.push(-150,40,-1);e.push(-100,60,-1);e.push(100,20,1);e.push(50,40,1);e.push(100,60,1);e.push(0,0+50,1);e.push(50,0+50,1);e.push(0,-50+50,1);e.push(0,0+50,1);e.push(0,-50+50,1);e.push(-50,0+50,1);e.push(0,0+50,1);e.push(-50,0+50,1);e.push(0,50+50,1);e.push(0,0+50,1);e.push(0,50+50,1);e.push(50,0+50,1);e.push(0,0+150,1);e.push(50,0+150,1);e.push(0,-50+150,1);e.push(0,0+150,1);e.push(0,-50+150,1);e.push(-50,0+150,1);e.push(0,0+150,1);e.push(-50,0+150,1);e.push(0,50+150,1);e.push(0,0+150,1);e.push(0,50+150,1);e.push(50,0+150,1);var s=new Array;s.push(0,1,2);s.push(3,4,5);s.push(6,7,8);s.push(9,10,11);s.push(12,13,14);s.push(15,16,17);s.push(18,19,20);s.push(21,22,23);s.push(24,25,26);s.push(27,28,29);s.push(30,31,32);s.push(33,34,35);s.push(36,37,38);var r=new Array;r.push(2,1);r.push(2,0);r.push(2,0);r.push(0,0);r.push(.5,0);r.push(1,1);r.push(0,0);r.push(.5,0);r.push(1,1);r.push(0,0);r.push(.5,0);r.push(1,1);r.push(0,0);r.push(.5,0);r.push(1,1);r.push(2,1);r.push(2,0);r.push(2,0);r.push(2,1);r.push(2,0);r.push(2,0);r.push(2,1);r.push(2,0);r.push(2,0);r.push(2,1);r.push(2,0);r.push(2,0);r.push(2,1);r.push(3,1);r.push(4,1);r.push(2,1);r.push(3,1);r.push(4,1);r.push(2,1);r.push(3,1);r.push(4,1);r.push(2,1);r.push(3,1);r.push(4,1);var t=new d(new i);t.autoDeriveUVs=false;t.setPositions(e);t.setIndices(s);t.setCurves(r);var a=new c;a.addSubGeometry(t);var o=new m(a);o.colorTransform=new n(1,1,1,1,0,0,0,0);var u=new _(16777215,.5);u.preserveAlpha=true;u.alphaBlending=true;u.useColorTransform=true;o.material=u;this._container.addChild(o)};e.prototype.addTexturedTris=function(){var e=this;var s=new Array;s.push(-300,-50-100,1);s.push(-200,50-100,1);s.push(-100,-50-100,1);s.push(-100,-50-100,-1);s.push(0,50-100,-1);s.push(100,-50-100,-1);s.push(100,-50-100,1);s.push(200,50-100,1);s.push(300,-50-100,1);var r=new Array;r.push(0,1,2);r.push(3,4,5);r.push(6,7,8);var t=new Array;t.push(2,1);t.push(3,1);t.push(4,1);t.push(0,0);t.push(.5,0);t.push(1,1);t.push(0,0);t.push(.5,0);t.push(1,1);var a=new Array;a.push(0,0);a.push(.5,1);a.push(1,0);a.push(0,0);a.push(.5,1);a.push(1,0);a.push(0,0);a.push(.5,1);a.push(1,0);var o=new d(new i);o.autoDeriveUVs=false;o.setPositions(s);o.setIndices(r);o.setCurves(t);o.setUVs(a);var u=new c;u.addSubGeometry(o);var l=new m(u);l._pPickingCollider=new g;l.mouseEnabled=true;l.mouseChildren=true;l.addEventListener(C.MOUSE_OVER,function(s){return e.onMeshMouseOver(s)});var h=new _(this._texture);h.preserveAlpha=true;h.alphaBlending=true;l.colorTransform=new n(1,1,1,1,0,0,0,0);l.material=h;h.useColorTransform=true;this._container.addChild(l)};e.prototype.onMeshMouseOver=function(e){var s=e.object;console.log("MESH MOUSE OVER")};e.prototype.imageCompleteHandler=function(e){this.initLights();this.initMaterial(e.target);this.initTorus()};e.prototype.render=function(e){if(e===void 0){e=null}if(this._mesh)this._mesh.rotationY+=1;this._view.render()};e.prototype.onResize=function(e){if(e===void 0){e=null}this._view.y=0;this._view.x=0;this._view.width=window.innerWidth;this._view.height=window.innerHeight};return e}();window.onload=function(){new A}},{"awayjs-core/lib/attributes/AttributesBuffer":undefined,"awayjs-core/lib/events/Event":undefined,"awayjs-core/lib/geom/ColorTransform":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-core/lib/net/URLLoader":undefined,"awayjs-core/lib/net/URLLoaderDataFormat":undefined,"awayjs-core/lib/net/URLRequest":undefined,"awayjs-core/lib/parsers/ParserUtils":undefined,"awayjs-core/lib/utils/RequestAnimationFrame":undefined,"awayjs-display/lib/base/CurveSubGeometry":undefined,"awayjs-display/lib/base/Geometry":undefined,"awayjs-display/lib/containers/DisplayObjectContainer":undefined,"awayjs-display/lib/containers/View":undefined,"awayjs-display/lib/controllers/HoverController":undefined,"awayjs-display/lib/entities/DirectionalLight":undefined,"awayjs-display/lib/entities/Mesh":undefined,"awayjs-display/lib/events/MouseEvent":undefined,"awayjs-display/lib/materials/BasicMaterial":undefined,"awayjs-display/lib/pick/JSPickingCollider":undefined,"awayjs-display/lib/pick/RaycastPicker":undefined,"awayjs-display/lib/textures/Single2DTexture":undefined,"awayjs-methodmaterials/lib/MethodMaterial":undefined,"awayjs-renderergl/lib/DefaultRenderer":undefined}]},{},["./src/CurveDemo.ts"]);

//# sourceMappingURL=CurveDemo.js.map