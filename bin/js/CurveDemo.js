(function e(r,s,t){function a(n,o){if(!s[n]){if(!r[n]){var u=typeof require=="function"&&require;if(!o&&u)return u(n,!0);if(i)return i(n,!0);var h=new Error("Cannot find module '"+n+"'");throw h.code="MODULE_NOT_FOUND",h}var l=s[n]={exports:{}};r[n][0].call(l.exports,function(e){var s=r[n][1][e];return a(s?s:e)},l,l.exports,e,r,s,t)}return s[n].exports}var i=typeof require=="function"&&require;for(var n=0;n<t.length;n++)a(t[n]);return a})({"./src/CurveDemo.ts":[function(e,r,s){var t=e("awayjs-core/lib/attributes/AttributesBuffer");var a=e("awayjs-core/lib/data/CurveSubGeometry");var i=e("awayjs-core/lib/data/Geometry");var n=e("awayjs-core/lib/events/Event");var o=e("awayjs-core/lib/geom/Vector3D");var u=e("awayjs-core/lib/geom/ColorTransform");var h=e("awayjs-core/lib/net/URLLoader");var l=e("awayjs-core/lib/net/URLLoaderDataFormat");var p=e("awayjs-core/lib/net/URLRequest");var d=e("awayjs-core/lib/parsers/ParserUtils");var v=e("awayjs-core/lib/utils/RequestAnimationFrame");var c=e("awayjs-display/lib/containers/View");var w=e("awayjs-display/lib/controllers/HoverController");var f=e("awayjs-display/lib/entities/DirectionalLight");var m=e("awayjs-display/lib/entities/Mesh");var y=e("awayjs-display/lib/materials/BasicMaterial");var _=e("awayjs-display/lib/textures/Single2DTexture");var g=e("awayjs-renderergl/lib/DefaultRenderer");var b=e("awayjs-methodmaterials/lib/MethodMaterial");var j=function(){function e(){var e=this;this.initView();this._raf=new v(this.render,this);this._raf.start();this.loadResources();window.onresize=function(r){return e.onResize(r)};this.onResize()}e.prototype.initView=function(){var e=this;this._view=new c(new g);this._view.backgroundColor=2245734;this._cameraController=new w(this._view.camera,null,0,0,-150,10,90);this._cameraController.lookAtPosition=new o(0,0,0);this._cameraController.tiltAngle=0;this._cameraController.panAngle=0;this._cameraController.minTiltAngle=-60;this._cameraController.maxTiltAngle=60;this._cameraController.autoUpdate=false;document.onmousedown=function(r){return e.onMouseDown(r)};document.onmouseup=function(r){return e.onMouseUp(r)};document.onmousemove=function(r){return e.onMouseMove(r)};document.onmousewheel=function(r){return e.onMouseWheel(r)}};e.prototype.onMouseDown=function(e){this._lastPanAngle=this._cameraController.panAngle;this._lastTiltAngle=this._cameraController.tiltAngle;this._lastMouseX=e.clientX;this._lastMouseY=e.clientY;this._move=true};e.prototype.onMouseUp=function(e){this._move=false};e.prototype.onMouseMove=function(e){if(this._move){this._cameraController.panAngle=.3*(e.clientX-this._lastMouseX)+this._lastPanAngle;this._cameraController.tiltAngle=.3*(e.clientY-this._lastMouseY)+this._lastTiltAngle}var r=this._view.unproject(this._view.mouseX,this._view.mouseY,0);var s=this._view.unproject(this._view.mouseX,this._view.mouseY,1).subtract(r);var t=new o(0,0,-1,0);var a=new o;var i=t.x*r.x+t.y*r.y+t.z*r.z+t.w;a.x=r.x-t.x*i;a.y=r.y-t.y*i;a.z=r.z-t.z*i;var n=new o(t.x,t.y,t.z);var u=-r.dotProduct(n)/s.dotProduct(n);s.scaleBy(u);var h=r.add(s);console.log(h);for(var l=0;l<this._view.scene.numChildren;l++){var p=this._view.scene.getChildAt(l);var d=p;if(d){var v=false;for(var c=0;c<d.geometry.subGeometries.length;c++){var w=d.geometry.subGeometries[c];v=this.hittestMesh(h.x,h.y,w);if(v)break}console.log("HIT::",v);if(v){var f=d.colorTransform;f.alphaMultiplier=.2;d.colorTransform=f}else{var f=d.colorTransform;f.alphaMultiplier=1;d.colorTransform=f}}}};e.prototype.hittestMesh=function(e,r,s){var t=s.positions.dimensions;var a=s.curves.dimensions;var i=s.indices.get(s.indices.count);var n=s.positions.get(s.positions.count);var o=s.curves.get(s.curves.count);for(var u=0;u<s.indices.length;u+=3){var h=i[u];var l=i[u+1]*t;var p=i[u+2]*t;var d=n[h*t];var v=n[h*t+1];var c=n[l];var w=n[l+1];var f=n[p];var m=n[p+1];var y=o[h*a];var _=n[h*t+2];var g=d-e;var b=v-r;var j=w-v;var C=-(c-d);var M=g*j+b*C;if(M>0)continue;g=c-e;b=w-r;j=m-w;C=-(f-c);M=g*j+b*C;if(M>0)continue;g=f-e;b=m-r;j=v-m;C=-(d-f);M=g*j+b*C;if(M>0)continue;if(y!=2){var T=c-d;var A=w-v;var x=f-d;var D=m-v;var L=e-d;var R=r-v;var U=T*D-x*A;var P=(L*D-x*R)/U;var z=(T*R-L*A)/U;var B=1-P-z;var V=.5*P+z;var q=z;var G=V*V-q;if(G>0&&_==-1){continue}else if(G<0&&_==1){continue}}return true}return false};e.prototype.onMouseWheel=function(e){this._cameraController.distance-=e.wheelDelta*2;if(this._cameraController.distance<100)this._cameraController.distance=100;else if(this._cameraController.distance>2e3)this._cameraController.distance=2e3};e.prototype.loadResources=function(){var e=this;var r=new h;r.dataFormat=l.BLOB;r.addEventListener(n.COMPLETE,function(r){return e.urlCompleteHandler(r)});r.load(new p("assets/dots_alpha.png"))};e.prototype.urlCompleteHandler=function(e){var r=this;this._image=d.blobToImage(e.target.data);this._image.onload=function(e){return r.imageCompleteHandler(e)}};e.prototype.initLights=function(){this._light=new f;this._light.diffuse=.7;this._light.specular=1};e.prototype.initMaterial=function(e){this._texture=new _(d.imageToBitmapImage2D(e));this._material=new b(this._texture,true,true,false);this._material.lightPicker=this._lightPicker};e.prototype.initTorus=function(){this.addSolidTris();this.addTexturedTris();this._view.camera.z+=750};e.prototype.addSolidTris=function(){var e=new Array;e.push(-300,-50,1);e.push(-200,50,1);e.push(-100,-50,1);e.push(-100,-50,-1);e.push(0,50,-1);e.push(100,-50,-1);e.push(100,-50,1);e.push(200,50,1);e.push(300,-50,1);e.push(-100,20,-1);e.push(-150,40,-1);e.push(-100,60,-1);e.push(100,20,1);e.push(50,40,1);e.push(100,60,1);e.push(0,0+50,1);e.push(50,0+50,1);e.push(0,-50+50,1);e.push(0,0+50,1);e.push(0,-50+50,1);e.push(-50,0+50,1);e.push(0,0+50,1);e.push(-50,0+50,1);e.push(0,50+50,1);e.push(0,0+50,1);e.push(0,50+50,1);e.push(50,0+50,1);e.push(0,0+150,1);e.push(50,0+150,1);e.push(0,-50+150,1);e.push(0,0+150,1);e.push(0,-50+150,1);e.push(-50,0+150,1);e.push(0,0+150,1);e.push(-50,0+150,1);e.push(0,50+150,1);e.push(0,0+150,1);e.push(0,50+150,1);e.push(50,0+150,1);var r=new Array;r.push(0,1,2);r.push(3,4,5);r.push(6,7,8);r.push(9,10,11);r.push(12,13,14);r.push(15,16,17);r.push(18,19,20);r.push(21,22,23);r.push(24,25,26);r.push(27,28,29);r.push(30,31,32);r.push(33,34,35);r.push(36,37,38);var s=new Array;s.push(2,1);s.push(2,0);s.push(2,0);s.push(0,0);s.push(.5,0);s.push(1,1);s.push(0,0);s.push(.5,0);s.push(1,1);s.push(0,0);s.push(.5,0);s.push(1,1);s.push(0,0);s.push(.5,0);s.push(1,1);s.push(2,1);s.push(2,0);s.push(2,0);s.push(2,1);s.push(2,0);s.push(2,0);s.push(2,1);s.push(2,0);s.push(2,0);s.push(2,1);s.push(2,0);s.push(2,0);s.push(2,1);s.push(3,1);s.push(4,1);s.push(2,1);s.push(3,1);s.push(4,1);s.push(2,1);s.push(3,1);s.push(4,1);s.push(2,1);s.push(3,1);s.push(4,1);var n=new a(new t);n.autoDeriveUVs=false;n.setPositions(e);n.setIndices(r);n.setCurves(s);var o=new i;o.addSubGeometry(n);var h=new m(o);h.colorTransform=new u(1,1,1,1,0,0,0,0);var l=new y(16777215,.5);l.preserveAlpha=true;l.alphaBlending=true;l.useColorTransform=true;h.material=l;this._view.scene.addChild(h)};e.prototype.addTexturedTris=function(){var e=new Array;e.push(-300,-50-100,1);e.push(-200,50-100,1);e.push(-100,-50-100,1);e.push(-100,-50-100,-1);e.push(0,50-100,-1);e.push(100,-50-100,-1);e.push(100,-50-100,1);e.push(200,50-100,1);e.push(300,-50-100,1);var r=new Array;r.push(0,1,2);r.push(3,4,5);r.push(6,7,8);var s=new Array;s.push(2,1);s.push(3,1);s.push(4,1);s.push(0,0);s.push(.5,0);s.push(1,1);s.push(0,0);s.push(.5,0);s.push(1,1);var n=new Array;n.push(0,0);n.push(.5,1);n.push(1,0);n.push(0,0);n.push(.5,1);n.push(1,0);n.push(0,0);n.push(.5,1);n.push(1,0);var o=new a(new t);o.autoDeriveUVs=false;o.setPositions(e);o.setIndices(r);o.setCurves(s);o.setUVs(n);var h=new i;h.addSubGeometry(o);var l=new m(h);var p=new y(this._texture);p.preserveAlpha=true;p.alphaBlending=true;l.colorTransform=new u(1,1,1,1,0,0,0,0);l.material=p;p.useColorTransform=true;this._view.scene.addChild(l)};e.prototype.imageCompleteHandler=function(e){this.initLights();this.initMaterial(e.target);this.initTorus()};e.prototype.render=function(e){if(e===void 0){e=null}if(this._mesh)this._mesh.rotationY+=1;this._view.render()};e.prototype.onResize=function(e){if(e===void 0){e=null}this._view.y=0;this._view.x=0;this._view.width=window.innerWidth;this._view.height=window.innerHeight};return e}();window.onload=function(){new j}},{"awayjs-core/lib/attributes/AttributesBuffer":undefined,"awayjs-core/lib/data/CurveSubGeometry":undefined,"awayjs-core/lib/data/Geometry":undefined,"awayjs-core/lib/events/Event":undefined,"awayjs-core/lib/geom/ColorTransform":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-core/lib/net/URLLoader":undefined,"awayjs-core/lib/net/URLLoaderDataFormat":undefined,"awayjs-core/lib/net/URLRequest":undefined,"awayjs-core/lib/parsers/ParserUtils":undefined,"awayjs-core/lib/utils/RequestAnimationFrame":undefined,"awayjs-display/lib/containers/View":undefined,"awayjs-display/lib/controllers/HoverController":undefined,"awayjs-display/lib/entities/DirectionalLight":undefined,"awayjs-display/lib/entities/Mesh":undefined,"awayjs-display/lib/materials/BasicMaterial":undefined,"awayjs-display/lib/textures/Single2DTexture":undefined,"awayjs-methodmaterials/lib/MethodMaterial":undefined,"awayjs-renderergl/lib/DefaultRenderer":undefined}]},{},["./src/CurveDemo.ts"]);

//# sourceMappingURL=CurveDemo.js.map